<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparatif 2025 - Les meilleurs produits tech</title>
    <link rel="stylesheet" href="assets/css/styles_tendances.css">
</head>
<body>
    <div class="entete">
        <a href="index.html" class="lien-top">Accueil</a>
    </div>
    <main>
        <div class="hero-tendances">
            <div class="hero-content">
                <h1>Comparatif 2025</h1>
                <p>Découvrez le comparatif des meilleurs produits tech de l'année : toutes les catégories du site réunies !</p>
            </div>
        </div>
        <!-- Onglets supprimés, on garde uniquement la barre stylée du comparatif -->
        <div class="container-tendances">
            <h2 style="text-align:center;margin-bottom:30px;">Comparatif par catégorie</h2>
            <div style="text-align:center;margin-bottom:24px;">
                <select id="select-categorie" class="select-categorie-custom">
                    <option value="console">Consoles</option>
                    <option value="drone">Drones</option>
                    <option value="casque-audio">Casques audio</option>
                    <option value="casque-vr">Casques VR</option>
                    <option value="pc-gaming">PC Gaming</option>
                    <option value="smartphone">Smartphones</option>
                    <option value="ecran-tv">Écrans TV</option>
                    <option value="imprimante-3d">Imprimantes 3D</option>
                    <option value="tablette">Tablettes</option>
                    <option value="video-projecteur">Vidéo-projecteurs</option>
                    <option value="serveur">Serveurs</option>
                    <option value="peripheriques">Périphériques</option>
                    <option value="montre-connectee">Montres connectées</option>
                    <option value="tableau-interactif">Tableaux interactifs</option>
                </select>
            </div>
            <style>
            .select-categorie-custom {
                padding: 12px 32px;
                font-size: 1.15em;
                border-radius: 16px;
                border: 2px solid #667eea;
                background: linear-gradient(90deg,#f093fb 0%,#667eea 100%);
                color: #fff;
                font-weight: 600;
                box-shadow: 0 2px 12px #667eea33;
                outline: none;
                transition: border 0.2s, box-shadow 0.2s;
                margin-bottom: 0;
                cursor: pointer;
            }
            .select-categorie-custom:focus {
                border-color: #f093fb;
                box-shadow: 0 0 0 2px #f093fb55;
            }
            .select-categorie-custom option {
                color: #333;
                background: #fff;
                font-weight: 500;
            }
            </style>
            <div id="tableau-comparatif"></div>
        </div>
    </main>
    <footer class="footer">
        <img src="assets/images/banniere-pied.png" alt="Bannière" class="footer-banner" />
        <div class="footer-links">
            <div class="footer-item">
                <img src="assets/images/logo-blanc.png" alt="Accueil" class="footer-icon" />
                <a href="index.html">Accueil</a>
            </div>
            <div class="footer-item">
                <img src="assets/images/etoile-blanche.png" alt="Top du Mois" class="footer-icon" />
                <a href="top-du-mois.html">Top du Mois</a>
            </div>
        </div>
    </footer>
    <script>
    // Tableau comparatif avec filtre catégorie
    let allProduits = [];
    const catVariants = {
        'console': ['console', 'consoles'],
        'drone': ['drone', 'drones'],
        'casque-audio': ['casque-audio', 'casques audio', 'casque audio'],
        'casque-vr': ['casque-vr', 'casques vr', 'casque vr'],
        'pc-gaming': ['pc-gaming', 'pc gaming'],
        'smartphone': ['smartphone', 'smartphones'],
        'ecran-tv': ['ecran-tv', 'écran tv', 'écrans tv', 'ecran', 'tv', 'oled', 'lcd'],
        'imprimante-3d': ['imprimante-3d', 'imprimantes 3d', 'imprimante 3d'],
        'tablette': ['tablette', 'tablettes'],
        'video-projecteur': ['video-projecteur', 'vidéo-projecteur', 'vidéo-projecteurs', 'video projecteur', 'projecteur'],
        'serveur': ['serveur', 'serveurs'],
        'peripheriques': ['peripheriques', 'périphériques'],
        'montre-connectee': ['montre-connectee', 'montres connectées', 'montre connectée', 'montre', 'watch', 'apple watch', 'garmin'],
        'tableau-interactif': ['tableau-interactif', 'tableaux interactifs', 'tableau interactif']
    };
    function chargerTableauComparatif(categorie = 'console') {
        const container = document.getElementById('tableau-comparatif');
        if (!container) return;
        container.innerHTML = '<div class="loader">Chargement...</div>';
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
          ? 'http://localhost:3000/api'
          : `http://${window.location.hostname}:3000/api`;
        if (allProduits.length === 0) {
            fetch(`${API_URL}/produits`).then(r => r.json()).then(data => {
                if (!data.success || !Array.isArray(data.data)) {
                    container.innerHTML = '<p>Erreur de chargement des produits.</p>';
                    return;
                }
                allProduits = data.data;
                afficherTableauCategorie(categorie);
            }).catch(() => {
                container.innerHTML = '<p>Erreur de connexion à la base de données.</p>';
            });
        } else {
            afficherTableauCategorie(categorie);
        }
    }
    function afficherTableauCategorie(categorie) {
        const container = document.getElementById('tableau-comparatif');
        let produits = allProduits;
        if (categorie && catVariants[categorie]) {
            produits = allProduits.filter(p => {
                const cat = (p.categorie || '').toLowerCase();
                return catVariants[categorie].some(variant => cat.includes(variant));
            });
        }
        container.innerHTML = genererTableauProduits(produits);
    }
    function genererTableauProduits(produits) {
        if (!produits.length) return '<p>Aucun produit trouvé.</p>';
        let html = `<table class="table-comparatif" style="width:100%;border-collapse:collapse;margin:0 auto;background:#fff;border-radius:12px;box-shadow:0 2px 16px #0002;overflow:hidden;">
        <thead style="background:#667eea;color:#fff;font-size:1.1em;">
            <tr>
                <th>Image</th>
                <th>Nom</th>
                <th>Catégorie</th>
                <th>Prix</th>
                <th>Note</th>
                <th>Spécifications</th>
            </tr>
        </thead>
        <tbody>`;
        produits.forEach(prod => {
            // On filtre les specs pour retirer le prix et la note éventuels
            let specs = Array.isArray(prod.donnees_fiche) ? prod.donnees_fiche.filter(spec => {
                const s = spec.toLowerCase();
                return !s.includes('prix') && !s.match(/\d+ ?€/) && !s.includes('note') && !s.includes('⭐');
            }) : [];
            html += `<tr style="border-bottom:1px solid #eee;">
                <td style="text-align:center;"><img src="/assets/images/${prod.image || 'placeholder.png'}" alt="${prod.nom}" style="max-width:80px;max-height:80px;object-fit:contain;border-radius:8px;background:#fff;box-shadow:0 1px 4px #0001;" /></td>
                <td style="font-weight:600;color:#333;">${prod.nom}</td>
                <td style="color:#667eea;font-weight:500;">${prod.categorie}</td>
                <td style="color:#222;">${prod.prix ? prod.prix + ' €' : ''}</td>
                <td style="color:#f093fb;font-weight:600;">${prod.note ? '⭐ ' + prod.note : ''}</td>
                <td style="font-size:0.95em;color:#444;">${specs.join('<br>')}</td>
            </tr>`;
        });
        html += '</tbody></table>';
        return html;
    }
    // Initialisation
    document.getElementById('select-categorie').addEventListener('change', function() {
        chargerTableauComparatif(this.value);
    });
    chargerTableauComparatif();
    </script>
</body>
</html>
