<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évolution des Prix - HIGH-TECH 2026</title>
    <meta name="description" content="Suivez l'évolution des prix de tous nos produits tech : smartphones, PC gaming, consoles et plus.">
    <meta name="keywords" content="évolution prix, suivi prix, historique prix, high-tech 2026">
    <meta name="robots" content="index, follow">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://high-tech-2026.com/2026/evolution-prix.html">
    <meta property="og:title" content="Évolution des Prix - HIGH-TECH 2026">
    <meta property="og:description" content="Suivez l'évolution des prix de tous nos produits tech.">

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#d4ff00">
    <link rel="apple-touch-icon" href="/assets/images/icons/icon-192x192.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Orbitron:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/theme.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>

    <style>
        main { padding-top: 100px; }

        .page-header {
            text-align: center;
            padding: 3rem 2rem;
        }
        .page-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 800;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Stats Summary */
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            max-width: 1200px;
            margin: 0 auto 2rem;
            padding: 0 2rem;
        }
        .stat-card {
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
        }
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .stat-value.green { color: var(--tech-green); }
        .stat-value.red { color: #ff6b6b; }
        .stat-value.blue { color: var(--tech-blue); }
        .stat-value.yellow { color: var(--tech-yellow); }
        .stat-label {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Filters */
        .filters-bar {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: 0 auto 2rem;
            padding: 0 2rem;
        }
        .filter-select {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
        }
        .filter-select:focus {
            outline: none;
            border-color: var(--tech-yellow);
        }

        /* Products Grid */
        .products-price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem 3rem;
        }

        .price-card {
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .price-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255,255,255,0.15);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .price-card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .price-card-img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 8px;
            background: rgba(255,255,255,0.03);
            padding: 4px;
        }
        .price-card-info {
            flex: 1;
            min-width: 0;
        }
        .price-card-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .price-card-category {
            color: var(--text-muted);
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .price-card-prices {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        .current-price {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--tech-yellow);
        }
        .price-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .price-badge.hausse {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        .price-badge.baisse {
            background: rgba(0, 255, 136, 0.15);
            color: var(--tech-green);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        .price-badge.stable {
            background: rgba(255,255,255,0.05);
            color: var(--text-muted);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Sparkline canvas */
        .sparkline-container {
            height: 50px;
            width: 100%;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal-content {
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-primary);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover { background: rgba(255,255,255,0.2); }
        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--tech-yellow);
            margin-bottom: 0.5rem;
            padding-right: 3rem;
        }
        .modal-subtitle {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
        }
        .chart-container {
            height: 300px;
            margin-bottom: 1.5rem;
        }
        .modal-history {
            max-height: 200px;
            overflow-y: auto;
        }
        .history-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.85rem;
        }
        .history-date { color: var(--text-muted); }
        .history-price { color: var(--text-primary); font-weight: 600; }

        /* Loading */
        .loading-container {
            text-align: center;
            padding: 4rem;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--tech-yellow);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        /* Scroll Top */
        .scroll-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .scroll-top.visible {
            opacity: 1;
            visibility: visible;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-summary {
                grid-template-columns: repeat(2, 1fr);
            }
            .products-price-grid {
                grid-template-columns: 1fr;
            }
            .chart-container {
                height: 200px;
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <nav class="nav-container">
            <a href="/2026/" class="logo-section">
                <svg class="logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="logoBg" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#d4ff00;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#6bff6b;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <polygon points="50,15 85,35 85,65 50,85 15,65 15,35" fill="none" stroke="url(#logoBg)" stroke-width="2.5" opacity="0.9"/>
                    <path d="M 50 25 L 58 45 L 48 45 L 54 70 L 38 48 L 50 48 Z" fill="url(#logoBg)" opacity="0.95"/>
                    <circle cx="30" cy="40" r="2.5" fill="#4dd4ff" opacity="0.7"/>
                    <circle cx="70" cy="60" r="2.5" fill="#a78bfa" opacity="0.7"/>
                </svg>
                <div class="logo-text">HIGH-TECH 2026</div>
            </a>
            <div class="nav-links">
                <a href="/2026/" class="nav-link">Accueil</a>
                <a href="/2026/#categories" class="nav-link">Categories</a>
                <a href="/2026/guides.html" class="nav-link">Guides</a>
                <a href="/2026/timeline.html" class="nav-link">Timeline</a>
                <a href="/2026/recherche.html" class="nav-link">Rechercher</a>
            </div>
        </nav>
    </header>

    <main>
        <div class="page-header">
            <nav style="margin-bottom: 1.5rem;">
                <a href="/2026/" style="color: var(--text-muted); text-decoration: none;">Accueil</a>
                <span style="color: var(--text-muted); margin: 0 0.5rem;">/</span>
                <span style="color: #ff6b6b;">Evolution des Prix</span>
            </nav>
            <h1 class="page-title">Evolution des Prix</h1>
            <p class="page-subtitle">
                Suivez l'evolution des prix de tous nos produits tech en temps reel.
            </p>
        </div>

        <!-- Stats Summary -->
        <div class="stats-summary">
            <div class="stat-card">
                <div class="stat-value blue" id="stat-produits">-</div>
                <div class="stat-label">Produits suivis</div>
            </div>
            <div class="stat-card">
                <div class="stat-value red" id="stat-hausses">-</div>
                <div class="stat-label">En hausse</div>
            </div>
            <div class="stat-card">
                <div class="stat-value green" id="stat-baisses">-</div>
                <div class="stat-label">En baisse</div>
            </div>
            <div class="stat-card">
                <div class="stat-value yellow" id="stat-stables">-</div>
                <div class="stat-label">Stables</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-bar">
            <select class="filter-select" id="filter-categorie" onchange="applyFilters()">
                <option value="">Toutes les categories</option>
            </select>
            <select class="filter-select" id="filter-tendance" onchange="applyFilters()">
                <option value="">Toutes tendances</option>
                <option value="hausse">En hausse</option>
                <option value="baisse">En baisse</option>
                <option value="stable">Stables</option>
            </select>
            <select class="filter-select" id="filter-tri" onchange="applyFilters()">
                <option value="nom">Tri par nom</option>
                <option value="prix-asc">Prix croissant</option>
                <option value="prix-desc">Prix decroissant</option>
                <option value="variation">Plus forte variation</option>
            </select>
        </div>

        <!-- Products Grid -->
        <div class="products-price-grid" id="products-grid">
            <div class="loading-container" style="grid-column: 1/-1;">
                <div class="loading-spinner"></div>
                <p style="color: var(--text-muted);">Chargement des donnees...</p>
            </div>
        </div>
    </main>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">X</button>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>HIGH-TECH 2026</h3>
                <p style="color: var(--text-secondary); line-height: 1.7;">
                    Votre source d'information de confiance pour la technologie de pointe.
                </p>
            </div>
            <div class="footer-section">
                <h3>Navigation</h3>
                <ul class="footer-links">
                    <li><a href="/2026/">Accueil</a></li>
                    <li><a href="/2026/produits.html">Produits</a></li>
                    <li><a href="/2026/tendances.html">Tendances</a></li>
                    <li><a href="/2026/comparatif.html">Comparatif</a></li>
                    <li><a href="/2026/guides.html">Guides</a></li>
                    <li><a href="/2026/configurateur.html">Configurateur</a></li>
                    <li><a href="/2026/evolution-prix.html">Évolution des Prix</a></li>
                    <li><a href="/2026/versus.html">Versus</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Categories</h3>
                <ul class="footer-links">
                    <li><a href="/2026/produits.html?categorie=smartphone">Smartphones</a></li>
                    <li><a href="/2026/produits.html?categorie=pc-gaming">PC Gaming</a></li>
                    <li><a href="/2026/produits.html?categorie=console">Consoles</a></li>
                    <li><a href="/2026/produits.html?categorie=casque-vr">VR/AR</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Ressources</h3>
                <ul class="footer-links">
                    <li><a href="/2026/wiki.html">Wiki</a></li>
                    <li><a href="/2026/timeline.html">Timeline Tech</a></li>
                    <li><a href="/2026/apropos.html">A propos</a></li>
                    <li><a href="/2026/admin.html">Admin</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 HIGH-TECH 2026 — Cree par Genin Wilfried. Tous droits reserves.</p>
        </div>
    </footer>

    <button class="scroll-top" id="scrollTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">^</button>

    <script src="/assets/js/theme-toggle.js"></script>
    <script>
    let allProducts = [];
    let detailChart = null;

    function parsePrice(str) {
        if (!str) return null;
        const cleaned = str.replace(/[^0-9,.\s]/g, '').replace(',', '.').replace(/\s/g, '');
        const num = parseFloat(cleaned);
        return isNaN(num) ? null : num;
    }

    function formatPrice(num) {
        if (num == null) return '-';
        return new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(num);
    }

    // Load data
    document.addEventListener('DOMContentLoaded', async () => {
        await Promise.all([loadStats(), loadProducts()]);
        initScrollTop();
    });

    async function loadStats() {
        try {
            const res = await fetch('/api/price-evolution/stats');
            const data = await res.json();
            if (data.success) {
                document.getElementById('stat-produits').textContent = data.stats.produits_suivis;
                document.getElementById('stat-hausses').textContent = data.stats.hausses;
                document.getElementById('stat-baisses').textContent = data.stats.baisses;
                document.getElementById('stat-stables').textContent = data.stats.stables;
            }
        } catch (e) {
            console.error('Erreur stats:', e);
        }
    }

    async function loadProducts() {
        try {
            const res = await fetch('/api/price-evolution/products-summary');
            const data = await res.json();
            if (data.success) {
                allProducts = data.data.map(p => {
                    const premier = parseFloat(p.premier_prix) || 0;
                    const dernier = parseFloat(p.dernier_prix) || 0;
                    const diff = premier > 0 ? ((dernier - premier) / premier * 100) : 0;
                    return { ...p, premier_num: premier, dernier_num: dernier, variation: diff };
                });

                // Populate category filter
                const categories = [...new Set(allProducts.map(p => p.categorie))].sort();
                const select = document.getElementById('filter-categorie');
                categories.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c;
                    opt.textContent = c;
                    select.appendChild(opt);
                });

                applyFilters();
            }
        } catch (e) {
            console.error('Erreur produits:', e);
            document.getElementById('products-grid').innerHTML = '<div class="empty-state" style="grid-column:1/-1;">Erreur de chargement. Avez-vous lance le snapshot initial ?</div>';
        }
    }

    function applyFilters() {
        const cat = document.getElementById('filter-categorie').value;
        const tendance = document.getElementById('filter-tendance').value;
        const tri = document.getElementById('filter-tri').value;

        let filtered = [...allProducts];

        if (cat) filtered = filtered.filter(p => p.categorie === cat);
        if (tendance === 'hausse') filtered = filtered.filter(p => p.variation > 1);
        else if (tendance === 'baisse') filtered = filtered.filter(p => p.variation < -1);
        else if (tendance === 'stable') filtered = filtered.filter(p => Math.abs(p.variation) <= 1);

        if (tri === 'prix-asc') filtered.sort((a, b) => a.dernier_num - b.dernier_num);
        else if (tri === 'prix-desc') filtered.sort((a, b) => b.dernier_num - a.dernier_num);
        else if (tri === 'variation') filtered.sort((a, b) => Math.abs(b.variation) - Math.abs(a.variation));
        else filtered.sort((a, b) => a.nom.localeCompare(b.nom));

        renderProducts(filtered);
    }

    function renderProducts(products) {
        const grid = document.getElementById('products-grid');

        if (products.length === 0) {
            grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1;">Aucun produit trouve avec ces filtres.</div>';
            return;
        }

        grid.innerHTML = products.map(p => {
            const variation = p.variation;
            let badgeClass, badgeText, badgeIcon;
            if (variation > 1) {
                badgeClass = 'hausse';
                badgeIcon = '&#8599;';
                badgeText = `+${variation.toFixed(1)}%`;
            } else if (variation < -1) {
                badgeClass = 'baisse';
                badgeIcon = '&#8600;';
                badgeText = `${variation.toFixed(1)}%`;
            } else {
                badgeClass = 'stable';
                badgeIcon = '&#8594;';
                badgeText = 'Stable';
            }

            const imgSrc = p.image ? (p.image.startsWith('/') ? p.image : `/assets/images/${p.image}`) : '/assets/images/placeholder.png';

            return `
                <div class="price-card" onclick="openModal('${p.id}')">
                    <div class="price-card-header">
                        <img src="${imgSrc}" alt="${p.nom}" class="price-card-img" onerror="this.src='/assets/images/placeholder.png'">
                        <div class="price-card-info">
                            <div class="price-card-name">${p.nom}</div>
                            <div class="price-card-category">${p.categorie || ''}</div>
                        </div>
                    </div>
                    <div class="price-card-prices">
                        <div class="current-price">${formatPrice(p.dernier_num)}</div>
                        <span class="price-badge ${badgeClass}">${badgeIcon} ${badgeText}</span>
                    </div>
                    <div class="sparkline-container">
                        <canvas id="spark-${p.id}"></canvas>
                    </div>
                </div>
            `;
        }).join('');

        // Draw sparklines
        products.forEach(p => {
            loadSparkline(p.id);
        });
    }

    async function loadSparkline(produitId) {
        try {
            const res = await fetch(`/api/price-evolution/produit/${produitId}`);
            const data = await res.json();
            if (!data.success || data.data.length < 2) return;

            const canvas = document.getElementById(`spark-${produitId}`);
            if (!canvas) return;

            const prices = data.data.map(d => parseFloat(d.prix_numerique) || 0);
            const trend = prices[prices.length - 1] >= prices[0] ? '#ff6b6b' : '#00ff88';

            new Chart(canvas, {
                type: 'line',
                data: {
                    labels: data.data.map(() => ''),
                    datasets: [{
                        data: prices,
                        borderColor: trend,
                        borderWidth: 2,
                        fill: true,
                        backgroundColor: trend === '#ff6b6b' ? 'rgba(255,107,107,0.1)' : 'rgba(0,255,136,0.1)',
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    animation: { duration: 500 }
                }
            });
        } catch (e) { /* ignore */ }
    }

    // Modal detail
    async function openModal(produitId) {
        const overlay = document.getElementById('modal-overlay');
        const body = document.getElementById('modal-body');

        body.innerHTML = '<div class="loading-container"><div class="loading-spinner"></div></div>';
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';

        try {
            const res = await fetch(`/api/price-evolution/produit/${produitId}`);
            const data = await res.json();

            if (!data.success || data.data.length === 0) {
                body.innerHTML = '<div class="empty-state">Aucun historique pour ce produit.</div>';
                return;
            }

            const product = data.data[0];
            const prices = data.data.map(d => parseFloat(d.prix_numerique) || 0);
            const dates = data.data.map(d => new Date(d.date_enregistrement).toLocaleDateString('fr-FR', { day: '2-digit', month: 'short', year: 'numeric' }));
            const min = Math.min(...prices);
            const max = Math.max(...prices);

            body.innerHTML = `
                <div class="modal-title">${product.nom}</div>
                <div class="modal-subtitle">${product.categorie} — Prix actuel : ${product.prix_actuel}</div>
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="stat-card" style="flex:1; padding: 1rem;">
                        <div class="stat-value green" style="font-size: 1.2rem;">${formatPrice(min)}</div>
                        <div class="stat-label">Prix min</div>
                    </div>
                    <div class="stat-card" style="flex:1; padding: 1rem;">
                        <div class="stat-value red" style="font-size: 1.2rem;">${formatPrice(max)}</div>
                        <div class="stat-label">Prix max</div>
                    </div>
                    <div class="stat-card" style="flex:1; padding: 1rem;">
                        <div class="stat-value blue" style="font-size: 1.2rem;">${data.data.length}</div>
                        <div class="stat-label">Releves</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="detail-chart"></canvas>
                </div>
                <h3 style="color: var(--text-primary); margin-bottom: 0.5rem; font-size: 1rem;">Historique</h3>
                <div class="modal-history">
                    ${data.data.slice().reverse().map(d => `
                        <div class="history-row">
                            <span class="history-date">${new Date(d.date_enregistrement).toLocaleDateString('fr-FR', { day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</span>
                            <span class="history-price">${d.prix}</span>
                        </div>
                    `).join('')}
                </div>
            `;

            // Destroy previous chart
            if (detailChart) detailChart.destroy();

            detailChart = new Chart(document.getElementById('detail-chart'), {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Prix',
                        data: prices,
                        borderColor: '#ff6b6b',
                        borderWidth: 2.5,
                        fill: true,
                        backgroundColor: 'rgba(255,107,107,0.1)',
                        pointBackgroundColor: '#ff6b6b',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#ff6b6b',
                            bodyColor: '#fff',
                            callbacks: {
                                label: ctx => formatPrice(ctx.parsed.y)
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: 'rgba(255,255,255,0.5)', maxRotation: 45 },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        },
                        y: {
                            ticks: {
                                color: 'rgba(255,255,255,0.5)',
                                callback: v => formatPrice(v)
                            },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        }
                    }
                }
            });

        } catch (e) {
            console.error('Erreur modal:', e);
            body.innerHTML = '<div class="empty-state">Erreur de chargement.</div>';
        }
    }

    function closeModal() {
        document.getElementById('modal-overlay').classList.remove('active');
        document.body.style.overflow = '';
        if (detailChart) { detailChart.destroy(); detailChart = null; }
    }

    // Escape key closes modal
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

    // Scroll top
    function initScrollTop() {
        const btn = document.getElementById('scrollTop');
        window.addEventListener('scroll', () => {
            btn.classList.toggle('visible', window.scrollY > 300);
        });
    }

    // Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js').then(() => {}).catch(() => {});
        });
    }
    </script>
</body>
</html>
