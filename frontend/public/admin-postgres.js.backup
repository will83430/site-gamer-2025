// admin-postgres.js - Interface admin connectÃ©e directement Ã  PostgreSQL
// AJOUTEZ CET OVERRIDE Ã€ LA FIN DE VOTRE FICHIER admin-postgres.js
// Cela va forcer la bonne version de collectFormData

// Override complet aprÃ¨s crÃ©ation de l'AdminManager
document.addEventListener('DOMContentLoaded', () => {
    console.log('ðŸ”§ OVERRIDE collectFormData avec formatage icÃ´nes');
    
    // Attendre que adminManager soit crÃ©Ã©
    setTimeout(() => {
        if (window.adminManager) {
            // FORCER le remplacement de la fonction collectFormData
            window.adminManager.collectFormData = function() {
                console.log('ðŸŽ¯ OVERRIDE collectFormData activÃ© !');
                
                const data = {
                    id: this.currentEditingProduct.id,
                    nom: document.getElementById('edit-nom').value,
                    categorie: document.getElementById('edit-categorie').value,
                    prix: document.getElementById('edit-prix').value,
                    description: document.getElementById('edit-description').value,
                    image: document.getElementById('edit-image').value,
                    lien: this.currentEditingProduct.lien,
                    top_du_mois: document.getElementById('edit-top').value === 'true',
                };

                // FonctionnalitÃ©s avancÃ©es
                const fonctionnalitesText = document.getElementById('edit-fonctionnalites').value;
                data.fonctionnalites_avancees = fonctionnalitesText
                    .split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0);

                // â­ FORMATAGE FORCÃ‰ avec icÃ´nes
                console.log('ðŸŽ¯ DÃ©but formatage FORCÃ‰ pour:', data.categorie);
                
                const sectionsMap = {
                    'CONSOLE': [
                        { emoji: "ðŸ“", titre: "Description dÃ©taillÃ©e" },
                        { emoji: "ðŸ’°", titre: "Prix" },
                        { emoji: "ðŸ§©", titre: "SpÃ©cifications" },
                        { emoji: "ðŸ–¥ï¸", titre: "Ã‰cran et affichage" },
                        { emoji: "ðŸ•¹ï¸", titre: "ContrÃ´leurs" },
                        { emoji: "ðŸŒ", titre: "ConnectivitÃ©" },
                        { emoji: "ðŸŽ®", titre: "ExpÃ©rience utilisateur" }
                    ],
                    'DRONE': [
                        { emoji: "ðŸ“", titre: "Description dÃ©taillÃ©e" },
                        { emoji: "ðŸ’°", titre: "Prix" },
                        { emoji: "ðŸ§©", titre: "SpÃ©cifications" },
                        { emoji: "ðŸŽ¥", titre: "Fonctions vidÃ©o" },
                        { emoji: "ðŸŒ", titre: "ConnectivitÃ©" },
                        { emoji: "ðŸŽ®", titre: "ExpÃ©rience utilisateur" }
                    ]
                };
                
                const sections = sectionsMap[data.categorie] || sectionsMap['CONSOLE'];
                data.donnees_fiche = [];
                
                // RÃ©cupÃ©rer TOUTES les textareas
                const textareas = document.querySelectorAll('#donnees-fiche-container textarea');
                console.log(`ðŸ“ Textareas trouvÃ©s: ${textareas.length}`);
                
                textareas.forEach((textarea, index) => {
                    const value = textarea.value || '';
                    console.log(`ðŸ“‹ Textarea [${index}]: "${value.substring(0, 30)}..."`);
                    
                    if (sections[index] && value.trim()) {
                        const formatted = `${sections[index].emoji} ${sections[index].titre}\n${value.trim()}`;
                        data.donnees_fiche.push(formatted);
                        console.log(`âœ… FORMATÃ‰ [${index}]: "${formatted.substring(0, 50)}..."`);
                    } else {
                        data.donnees_fiche.push(value);
                        console.log(`âšª BRUT [${index}]: "${value.substring(0, 30)}..."`);
                    }
                });
                
                console.log('ðŸŽ¯ RÃ‰SULTAT FINAL OVERRIDE:', data.donnees_fiche);
                return data;
            };
            
            console.log('âœ… Override collectFormData installÃ© !');
        } else {
            console.error('âŒ adminManager non trouvÃ© pour override');
        }
    }, 1000);
});

// Initialisation quand la page est chargÃ©e
document.addEventListener('DOMContentLoaded', () => {
    console.log('ðŸŽ¯ Initialisation interface admin PostgreSQL directe');
    window.adminManager = new AdminManager();
});

// Fonctions globales pour compatibilitÃ© avec l'HTML existant
function loadProductForEdit() {
    if (window.adminManager) {
        window.adminManager.loadProductForEdit();
    }
}

function saveProduct() {
    if (window.adminManager) {
        window.adminManager.saveToPostgreSQL();
    }
}