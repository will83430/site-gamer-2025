<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture HIGH-TECH 2026 - Schema Interactif</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Orbitron:wght@500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a24 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0 40px;
            border-bottom: 2px solid rgba(212, 255, 0, 0.3);
            margin-bottom: 30px;
        }

        header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            background: linear-gradient(135deg, #d4ff00 0%, #6bff6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        header p {
            color: #a0a0b0;
            font-size: 1.1em;
        }

        .tech-badges {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .tech-badge {
            background: rgba(212, 255, 0, 0.1);
            border: 1px solid #d4ff00;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #d4ff00;
        }

        .metrics {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .metric {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9em;
        }

        .metric strong {
            color: #d4ff00;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .btn-all { background: linear-gradient(135deg, #d4ff00, #6bff6b); color: #0a0a0f; }
        .btn-frontend { background: linear-gradient(135deg, #4fc3f7, #0288d1); color: #fff; }
        .btn-backend { background: linear-gradient(135deg, #ff8a65, #ff5722); color: #fff; }
        .btn-database { background: linear-gradient(135deg, #ffd54f, #ff8f00); color: #333; }
        .btn-seo { background: linear-gradient(135deg, #81c784, #43a047); color: #fff; }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn.active { box-shadow: 0 0 20px rgba(212, 255, 0, 0.5); }

        .flow-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            overflow-x: auto;
            padding: 20px 0;
            position: relative;
            min-height: 600px;
        }

        .connections-svg {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1;
        }

        .flow-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 200px;
            z-index: 2;
        }

        .column-title {
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.95em;
            text-align: center;
            margin-bottom: 10px;
        }

        .node {
            background: linear-gradient(145deg, #1a1a24, #12121a);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .node:hover {
            transform: translateY(-3px);
            border-color: #d4ff00;
            box-shadow: 0 8px 25px rgba(212, 255, 0, 0.2);
        }

        .node.dimmed {
            opacity: 0.15;
            filter: grayscale(50%);
        }

        .node.active {
            transform: scale(1.05);
            border-color: #d4ff00 !important;
            box-shadow: 0 0 30px rgba(212, 255, 0, 0.4);
            animation: pulse-node 1.5s infinite;
        }

        .node.connected-target {
            border-color: #d4ff00 !important;
            box-shadow: 0 0 20px rgba(212, 255, 0, 0.3);
            opacity: 1 !important;
        }

        .node.connected-source {
            border-color: #6bff6b !important;
            box-shadow: 0 0 20px rgba(107, 255, 107, 0.3);
            opacity: 1 !important;
        }

        @keyframes pulse-node {
            0%, 100% { box-shadow: 0 0 30px rgba(212, 255, 0, 0.4); }
            50% { box-shadow: 0 0 40px rgba(212, 255, 0, 0.6); }
        }

        .node-title {
            font-weight: 600;
            font-size: 0.95em;
            margin-bottom: 5px;
        }

        .node-desc {
            font-size: 0.8em;
            color: #a0a0b0;
        }

        .node-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #d4ff00, #6bff6b);
            color: #0a0a0f;
            font-size: 0.7em;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 700;
        }

        .connection-badge {
            position: absolute;
            top: -8px;
            left: -8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: 700;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .node:hover .connection-badge { opacity: 1; }

        .connection-line {
            stroke: rgba(255,255,255,0.15);
            stroke-width: 2px;
            fill: none;
            transition: all 0.3s ease;
        }

        .connection-line.dimmed { opacity: 0.05; }
        .connection-line.active { stroke: #d4ff00; stroke-width: 3px; opacity: 1 !important; filter: drop-shadow(0 0 5px rgba(212, 255, 0, 0.5)); }
        .connection-line.incoming { stroke: #6bff6b; stroke-width: 3px; opacity: 1 !important; filter: drop-shadow(0 0 5px rgba(107, 255, 107, 0.5)); }

        .connection-arrow {
            fill: rgba(255,255,255,0.15);
            transition: all 0.3s ease;
        }

        .connection-arrow.dimmed { opacity: 0.05; }
        .connection-arrow.active { fill: #d4ff00; opacity: 1 !important; }
        .connection-arrow.incoming { fill: #6bff6b; opacity: 1 !important; }

        .connections-count {
            position: fixed;
            top: 100px;
            right: 20px;
            background: linear-gradient(135deg, #1a1a24, #12121a);
            border: 2px solid #d4ff00;
            padding: 15px 20px;
            border-radius: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .connections-count.show { opacity: 1; }
        .count-label { font-size: 0.8em; color: #a0a0b0; margin-bottom: 5px; }
        .count-value { font-size: 1.5em; font-weight: 700; color: #d4ff00; }

        .legend {
            margin-top: 40px;
            padding: 30px;
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .legend h3 {
            color: #d4ff00;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .legend-color {
            width: 40px;
            height: 25px;
            border-radius: 6px;
        }

        .legend-label { font-weight: 600; font-size: 0.9em; }
        .legend-desc { font-size: 0.8em; color: #6a6a7a; }

        /* Node specific colors */
        .node-frontend { background: linear-gradient(145deg, #4fc3f7, #0288d1) !important; color: #fff; }
        .node-backend { background: linear-gradient(145deg, #ff8a65, #ff5722) !important; color: #fff; }
        .node-database { background: linear-gradient(145deg, #ffd54f, #ff8f00) !important; color: #333; }
        .node-seo { background: linear-gradient(145deg, #81c784, #43a047) !important; color: #fff; }
        .node-config { background: linear-gradient(145deg, #b39ddb, #7e57c2) !important; color: #fff; }
        .node-admin { background: linear-gradient(145deg, #f48fb1, #e91e63) !important; color: #fff; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HIGH-TECH 2026</h1>
            <p>Architecture Interactive du Projet</p>

            <div class="tech-badges">
                <span class="tech-badge">Node.js + Express</span>
                <span class="tech-badge">PostgreSQL</span>
                <span class="tech-badge">HTML/CSS/JS Vanilla</span>
                <span class="tech-badge">SEO Optimized</span>
            </div>

            <div class="metrics">
                <div class="metric"><strong>7</strong> Pages Frontend</div>
                <div class="metric"><strong>16</strong> Categories</div>
                <div class="metric"><strong>20+</strong> API Endpoints</div>
                <div class="metric"><strong>10</strong> Tables BDD</div>
            </div>
        </header>

        <div class="controls">
            <button class="btn btn-all active" onclick="filterLayer('all')">Tout afficher</button>
            <button class="btn btn-frontend" onclick="filterLayer('frontend')">Frontend</button>
            <button class="btn btn-backend" onclick="filterLayer('backend')">Backend API</button>
            <button class="btn btn-database" onclick="filterLayer('database')">Database</button>
            <button class="btn btn-seo" onclick="filterLayer('seo')">SEO</button>
        </div>

        <div class="connections-count" id="connectionsCount">
            <div class="count-label">Connexions</div>
            <div class="count-value">
                <span id="outgoingCount">0</span> sortantes | <span id="incomingCount">0</span> entrantes
            </div>
        </div>

        <div class="flow-container">
            <svg class="connections-svg" id="connectionsSvg"></svg>

            <!-- Frontend Pages Column -->
            <div class="flow-column layer-frontend layer-all">
                <div class="column-title" style="background: linear-gradient(135deg, #4fc3f7, #0288d1);">
                    Frontend Pages
                </div>

                <div class="node node-frontend" id="indexPage" data-connects="serverNode,themeToggle">
                    <div class="connection-badge">2</div>
                    <div class="node-title">index.html</div>
                    <div class="node-desc">Accueil + Hero + Categories</div>
                </div>

                <div class="node node-frontend" id="produitsPage" data-connects="serverNode,themeToggle">
                    <div class="connection-badge">2</div>
                    <div class="node-title">produits.html</div>
                    <div class="node-desc">Liste produits + Filtres</div>
                </div>

                <div class="node node-frontend" id="fichePage" data-connects="serverNode,schemaProduct,themeToggle">
                    <div class="connection-badge">3</div>
                    <div class="node-title">fiche.html</div>
                    <div class="node-desc">Fiche produit dynamique</div>
                    <div class="node-badge">SEO</div>
                </div>

                <div class="node node-frontend" id="tendancesPage" data-connects="serverNode,themeToggle">
                    <div class="connection-badge">2</div>
                    <div class="node-title">tendances.html</div>
                    <div class="node-desc">Articles par categorie</div>
                </div>

                <div class="node node-frontend" id="articlePage" data-connects="serverNode,schemaArticle,ficheTendanceJS,themeToggle">
                    <div class="connection-badge">4</div>
                    <div class="node-title">article.html</div>
                    <div class="node-desc">Article + Sections</div>
                    <div class="node-badge">SEO</div>
                </div>

                <div class="node node-frontend" id="comparatifPage" data-connects="serverNode,themeToggle">
                    <div class="connection-badge">2</div>
                    <div class="node-title">comparatif.html</div>
                    <div class="node-desc">Comparateur 4 produits</div>
                </div>

                <div class="node node-admin" id="adminPage" data-connects="serverNode,routesProduits,routesActualites,routesStats,routesWiki">
                    <div class="connection-badge">5</div>
                    <div class="node-title">admin.html</div>
                    <div class="node-desc">Dashboard complet</div>
                    <div class="node-badge">CRUD</div>
                </div>
            </div>

            <!-- Assets / JS Column -->
            <div class="flow-column layer-frontend layer-all">
                <div class="column-title" style="background: linear-gradient(135deg, #ba68c8, #9c27b0);">
                    Assets JS
                </div>

                <div class="node node-config" id="themeToggle">
                    <div class="node-title">theme-toggle.js</div>
                    <div class="node-desc">Mode sombre/clair</div>
                    <div class="node-badge">NEW</div>
                </div>

                <div class="node node-config" id="ficheTendanceJS" data-connects="serverNode">
                    <div class="connection-badge">1</div>
                    <div class="node-title">fiche-tendance.js</div>
                    <div class="node-desc">Chargement articles</div>
                </div>
            </div>

            <!-- Server Column -->
            <div class="flow-column layer-backend layer-all">
                <div class="column-title" style="background: linear-gradient(135deg, #ff8a65, #ff5722);">
                    server-2026.js
                </div>

                <div class="node node-backend" id="serverNode" data-connects="configDB,routesProduits,routesActualites,routesFicheTendance,routesStats,routesWiki,routesSitemap,routesAnnouncements">
                    <div class="connection-badge">8</div>
                    <div class="node-title">Express App</div>
                    <div class="node-desc">Port 3000</div>
                    <div class="node-badge">Main</div>
                </div>
            </div>

            <!-- Routes Column -->
            <div class="flow-column layer-backend layer-all">
                <div class="column-title" style="background: linear-gradient(135deg, #f48fb1, #e91e63);">
                    Routes API
                </div>

                <div class="node node-backend" id="routesProduits" data-connects="configDB,tableProduits">
                    <div class="connection-badge">2</div>
                    <div class="node-title">produits.js</div>
                    <div class="node-desc">/api/produits CRUD</div>
                </div>

                <div class="node node-backend" id="routesActualites" data-connects="configDB,tableActualites">
                    <div class="connection-badge">2</div>
                    <div class="node-title">tendances.js</div>
                    <div class="node-desc">/api/actualites CRUD</div>
                </div>

                <div class="node node-backend" id="routesFicheTendance" data-connects="configDB,tableActualites,tableSections">
                    <div class="connection-badge">3</div>
                    <div class="node-title">fichesTendances.js</div>
                    <div class="node-desc">/api/fiche-tendance</div>
                </div>

                <div class="node node-backend" id="routesStats" data-connects="configDB,tableProduits,tableActualites,tableSiteStats">
                    <div class="connection-badge">4</div>
                    <div class="node-title">stats.js</div>
                    <div class="node-desc">/api/stats/*</div>
                </div>

                <div class="node node-backend" id="routesWiki" data-connects="configDB,tableWiki">
                    <div class="connection-badge">2</div>
                    <div class="node-title">wiki.js</div>
                    <div class="node-desc">/api/wiki CRUD</div>
                </div>

                <div class="node node-backend" id="routesAnnouncements" data-connects="configDB,tableAnnouncements">
                    <div class="connection-badge">2</div>
                    <div class="node-title">announcements.js</div>
                    <div class="node-desc">/api/announcements</div>
                </div>

                <div class="node node-seo" id="routesSitemap" data-connects="configDB,tableProduits,tableActualites">
                    <div class="connection-badge">3</div>
                    <div class="node-title">sitemap.js</div>
                    <div class="node-desc">/sitemap.xml</div>
                    <div class="node-badge">SEO</div>
                </div>
            </div>

            <!-- Config Column -->
            <div class="flow-column layer-backend layer-all">
                <div class="column-title" style="background: linear-gradient(135deg, #b39ddb, #7e57c2);">
                    Configuration
                </div>

                <div class="node node-config" id="configDB" data-connects="postgresDB">
                    <div class="connection-badge">1</div>
                    <div class="node-title">database.js</div>
                    <div class="node-desc">Pool PostgreSQL</div>
                </div>

                <div class="node node-config" id="envFile">
                    <div class="node-title">.env</div>
                    <div class="node-desc">Credentials</div>
                </div>

                <div class="node node-config" id="loggerNode">
                    <div class="node-title">logger.js</div>
                    <div class="node-desc">Winston logging</div>
                </div>
            </div>

            <!-- Database Column -->
            <div class="flow-column layer-database layer-all">
                <div class="column-title" style="background: linear-gradient(135deg, #ffd54f, #ff8f00);">
                    PostgreSQL
                </div>

                <div class="node node-database" id="postgresDB">
                    <div class="node-title">site_gamer</div>
                    <div class="node-desc">Base de donnees</div>
                </div>

                <div class="node node-database" id="tableProduits">
                    <div class="node-title">produits</div>
                    <div class="node-desc">+ donnees_fiche JSONB</div>
                </div>

                <div class="node node-database" id="tableActualites">
                    <div class="node-title">actualites</div>
                    <div class="node-desc">Articles tendances</div>
                </div>

                <div class="node node-database" id="tableSections">
                    <div class="node-title">actualites_sections</div>
                    <div class="node-desc">Sections articles</div>
                </div>

                <div class="node node-database" id="tableCategories">
                    <div class="node-title">categories</div>
                    <div class="node-desc">16 categories</div>
                </div>

                <div class="node node-database" id="tableWiki">
                    <div class="node-title">wiki</div>
                    <div class="node-desc">Pages documentation</div>
                </div>

                <div class="node node-database" id="tableSiteStats">
                    <div class="node-title">site_stats</div>
                    <div class="node-desc">Compteurs visites</div>
                </div>

                <div class="node node-database" id="tableAnnouncements">
                    <div class="node-title">announcements</div>
                    <div class="node-desc">Annonces homepage</div>
                </div>

                <div class="node node-database" id="tableActivityLogs">
                    <div class="node-title">activity_logs</div>
                    <div class="node-desc">Journal activite</div>
                </div>
            </div>

            <!-- SEO Column -->
            <div class="flow-column layer-seo layer-all">
                <div class="column-title" style="background: linear-gradient(135deg, #81c784, #43a047);">
                    SEO
                </div>

                <div class="node node-seo" id="schemaProduct">
                    <div class="node-title">Schema.org Product</div>
                    <div class="node-desc">JSON-LD dynamique</div>
                </div>

                <div class="node node-seo" id="schemaArticle">
                    <div class="node-title">Schema.org Article</div>
                    <div class="node-desc">JSON-LD dynamique</div>
                </div>

                <div class="node node-seo" id="robotsTxt">
                    <div class="node-title">robots.txt</div>
                    <div class="node-desc">Crawl rules</div>
                </div>

                <div class="node node-seo" id="metaTags">
                    <div class="node-title">Meta Tags</div>
                    <div class="node-desc">OG + Twitter Cards</div>
                </div>
            </div>
        </div>

        <div class="legend">
            <h3>Legende</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #4fc3f7, #0288d1);"></div>
                    <div>
                        <div class="legend-label">Frontend Pages</div>
                        <div class="legend-desc">7 pages HTML dynamiques</div>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #f48fb1, #e91e63);"></div>
                    <div>
                        <div class="legend-label">Admin Dashboard</div>
                        <div class="legend-desc">CRUD complet</div>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #ff8a65, #ff5722);"></div>
                    <div>
                        <div class="legend-label">Backend API</div>
                        <div class="legend-desc">Express + Routes</div>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #b39ddb, #7e57c2);"></div>
                    <div>
                        <div class="legend-label">Configuration</div>
                        <div class="legend-desc">DB Pool + Env</div>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #ffd54f, #ff8f00);"></div>
                    <div>
                        <div class="legend-label">PostgreSQL</div>
                        <div class="legend-desc">10 tables</div>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #81c784, #43a047);"></div>
                    <div>
                        <div class="legend-label">SEO</div>
                        <div class="legend-desc">Schema.org + Sitemap</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFilter = 'all';
        let lockedNode = null;

        function drawConnections() {
            const svg = document.getElementById('connectionsSvg');
            svg.innerHTML = '';

            const container = document.querySelector('.flow-container');
            const containerRect = container.getBoundingClientRect();

            svg.setAttribute('width', container.scrollWidth);
            svg.setAttribute('height', container.scrollHeight);
            svg.style.width = container.scrollWidth + 'px';
            svg.style.height = container.scrollHeight + 'px';

            document.querySelectorAll('.node[data-connects]').forEach(node => {
                const connects = node.dataset.connects;
                if (!connects || node.offsetParent === null) return;

                const nodeRect = node.getBoundingClientRect();

                connects.split(',').forEach(targetId => {
                    const target = document.getElementById(targetId.trim());
                    if (!target || target.offsetParent === null) return;

                    const targetRect = target.getBoundingClientRect();

                    const startX = nodeRect.right - containerRect.left + container.scrollLeft;
                    const startY = nodeRect.top + nodeRect.height / 2 - containerRect.top + container.scrollTop;
                    const endX = targetRect.left - containerRect.left + container.scrollLeft;
                    const endY = targetRect.top + targetRect.height / 2 - containerRect.top + container.scrollTop;

                    const horizontalOffset = Math.max(Math.abs(endX - startX) * 0.5, 60);

                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const d = `M ${startX} ${startY} C ${startX + horizontalOffset} ${startY}, ${endX - horizontalOffset} ${endY}, ${endX} ${endY}`;

                    path.setAttribute('d', d);
                    path.setAttribute('class', 'connection-line');
                    path.setAttribute('data-from', node.id);
                    path.setAttribute('data-to', targetId.trim());
                    svg.appendChild(path);

                    // Arrow
                    const angle = Math.atan2(endY - startY, endX - startX);
                    const arrowSize = 8;
                    const arrowX = endX - 10 * Math.cos(angle);
                    const arrowY = endY - 10 * Math.sin(angle);

                    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    const points = [
                        [arrowX, arrowY],
                        [arrowX - arrowSize * Math.cos(angle - Math.PI / 6), arrowY - arrowSize * Math.sin(angle - Math.PI / 6)],
                        [arrowX - arrowSize * Math.cos(angle + Math.PI / 6), arrowY - arrowSize * Math.sin(angle + Math.PI / 6)]
                    ].map(p => p.join(',')).join(' ');

                    arrow.setAttribute('points', points);
                    arrow.setAttribute('class', 'connection-arrow');
                    arrow.setAttribute('data-from', node.id);
                    arrow.setAttribute('data-to', targetId.trim());
                    svg.appendChild(arrow);
                });
            });
        }

        function filterLayer(layer) {
            currentFilter = layer;

            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.flow-column').forEach(column => {
                if (layer === 'all' || column.classList.contains('layer-' + layer)) {
                    column.style.display = 'flex';
                } else {
                    column.style.display = 'none';
                }
            });

            setTimeout(drawConnections, 100);
        }

        function initNodeInteractions() {
            document.querySelectorAll('.node').forEach(node => {
                node.addEventListener('mouseenter', function() {
                    if (lockedNode && lockedNode !== this) return;
                    highlightNode(this);
                });

                node.addEventListener('mouseleave', function() {
                    if (lockedNode) return;
                    clearHighlights();
                });

                node.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (lockedNode === this) {
                        lockedNode = null;
                        clearHighlights();
                    } else {
                        if (lockedNode) lockedNode.classList.remove('locked');
                        lockedNode = this;
                        clearHighlights();
                        highlightNode(this);
                    }
                });
            });

            document.addEventListener('click', function(e) {
                if (lockedNode && !e.target.closest('.node')) {
                    lockedNode = null;
                    clearHighlights();
                }
            });
        }

        function highlightNode(node) {
            const nodeId = node.id;
            const connects = node.dataset.connects;
            const svg = document.getElementById('connectionsSvg');

            document.querySelectorAll('.node').forEach(n => n.classList.add('dimmed'));
            document.querySelectorAll('.connection-line, .connection-arrow').forEach(c => c.classList.add('dimmed'));

            node.classList.remove('dimmed');
            node.classList.add('active');

            let outgoingCount = 0;
            let incomingCount = 0;

            if (connects) {
                connects.split(',').forEach(id => {
                    const target = document.getElementById(id.trim());
                    if (target && target.offsetParent !== null) {
                        target.classList.remove('dimmed');
                        target.classList.add('connected-target');
                        outgoingCount++;

                        svg.querySelectorAll(`[data-from="${nodeId}"][data-to="${id.trim()}"]`).forEach(c => {
                            c.classList.remove('dimmed');
                            c.classList.add('active');
                        });
                    }
                });
            }

            svg.querySelectorAll(`.connection-line[data-to="${nodeId}"]`).forEach(conn => {
                const fromId = conn.getAttribute('data-from');
                const fromNode = document.getElementById(fromId);

                if (fromNode && fromNode.offsetParent !== null) {
                    conn.classList.remove('dimmed');
                    conn.classList.add('incoming');
                    svg.querySelectorAll(`[data-from="${fromId}"][data-to="${nodeId}"]`).forEach(c => {
                        c.classList.remove('dimmed');
                        c.classList.add('incoming');
                    });
                    fromNode.classList.remove('dimmed');
                    fromNode.classList.add('connected-source');
                    incomingCount++;
                }
            });

            document.getElementById('outgoingCount').textContent = outgoingCount;
            document.getElementById('incomingCount').textContent = incomingCount;
            document.getElementById('connectionsCount').classList.add('show');
        }

        function clearHighlights() {
            document.querySelectorAll('.node').forEach(n => n.classList.remove('active', 'connected-target', 'connected-source', 'dimmed'));
            document.querySelectorAll('.connection-line, .connection-arrow').forEach(c => c.classList.remove('active', 'incoming', 'dimmed'));
            document.getElementById('connectionsCount').classList.remove('show');
        }

        window.addEventListener('load', function() {
            drawConnections();
            initNodeInteractions();
        });
        window.addEventListener('resize', drawConnections);
    </script>
</body>
</html>
