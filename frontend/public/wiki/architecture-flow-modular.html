<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Site Gamer 2025 - Architecture Modulaire</title>
    <link rel="stylesheet" href="architecture-flow-modular.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ® Architecture Site Gamer 2025</h1>
            <p>Architecture Modulaire RefactorisÃ©e</p>
            <div class="metrics">
                <div class="metric">ğŸ“¦ <strong>8</strong> modules routes</div>
                <div class="metric">ğŸ“‰ <strong>-59%</strong> code server.js</div>
                <div class="metric">ğŸ“œ <strong>51</strong> scripts migrÃ©s</div>
                <div class="metric">ğŸ“ <strong>4</strong> dossiers organisÃ©s</div>
                <div class="metric">âœ… <strong>15/15</strong> tests passants</div>
            </div>
        </header>
        
        <div class="controls">
            <button class="btn btn-all active" onclick="filterLayer('all')">Tout afficher</button>
            <button class="btn btn-frontend" onclick="filterLayer('frontend')">Frontend</button>
            <button class="btn btn-config" onclick="filterLayer('config')">Config</button>
            <button class="btn btn-routes" onclick="filterLayer('routes')">Routes</button>
            <button class="btn btn-database" onclick="filterLayer('database')">Database</button>
            <button class="btn btn-scripts" onclick="filterLayer('scripts')">Scripts</button>
            <button class="btn btn-tests" onclick="filterLayer('tests')">Tests</button>
        </div>
        
        <div class="flow-container">
            <svg class="connections-svg" id="connectionsSvg"></svg>
            
            <div class="flow-column layer-frontend layer-all">
                <div class="column-title frontend-title">ğŸ¨ Frontend</div>
                
                <div class="node node-html" id="indexHTML" data-connects="fichesJS">
                    <div class="node-title">ğŸ“„ index.html</div>
                    <div class="node-desc">Page d'accueil</div>
                </div>
                
                <div class="node node-html" id="topHTML" data-connects="fichesJS">
                    <div class="node-title">ğŸ“„ top-du-mois.html</div>
                    <div class="node-desc">Top produits</div>
                </div>
                
                <div class="node node-html" id="tendancesHTML" data-connects="tendancesJS">
                    <div class="node-title">ğŸ“„ tendances.html</div>
                    <div class="node-desc">ActualitÃ©s tech</div>
                </div>
                
                <div class="node node-js" id="fichesJS" data-connects="serverNode">
                    <div class="node-title">âš¡ fiches.js</div>
                    <div class="node-desc">Fetch produits API</div>
                </div>
                
                <div class="node node-js" id="tendancesJS" data-connects="serverNode">
                    <div class="node-title">âš¡ tendances.js</div>
                    <div class="node-desc">Fetch actualitÃ©s</div>
                </div>
            </div>
            
            <!-- Server Column -->
            <div class="flow-column layer-config layer-routes layer-all">
                <div class="column-title" style="background: linear-gradient(135deg, #34495e, #2c3e50); color: white;">
                    âš™ï¸ server.js
                </div>
                
                <div class="node" id="serverNode" data-connects="configNode,routesProduits,routesFiches,routesTendances,routesContent,routesTech,routesMarche,routesInsights,routesPred" style="background: linear-gradient(135deg, #FFE0B2, #FFB74D); color: #333; border: 3px solid #F57C00;">
                    <div class="node-title">ğŸš€ Express App</div>
                    <div class="node-desc">260 lignes (-59%)</div>
                    <div class="node-badge">RefactorisÃ©</div>
                </div>
            </div>
            
            <!-- Config Column -->
            <div class="flow-column layer-config layer-all">
                <div class="column-title config-title">âš¡ Configuration</div>
                
                <div class="node node-config" id="configNode" data-connects="envNode,dbNode">
                    <div class="node-title">ğŸ”§ database.js</div>
                    <div class="node-desc">Pool PostgreSQL centralisÃ©</div>
                    <div class="node-badge">NEW</div>
                </div>
                
                <div class="node node-env" id="envNode">
                    <div class="node-title">ğŸ” .env</div>
                    <div class="node-desc">Credentials (gitignored)</div>
                    <div class="node-badge">NEW</div>
                </div>
            </div>
            
            <!-- Routes Column -->
            <div class="flow-column layer-routes layer-all">
                <div class="column-title routes-title">ğŸ›£ï¸ Routes Modules</div>
                
                <div class="node node-module" id="routesProduits" data-connects="configNode,tableProduits">
                    <div class="node-title">ğŸ“¦ produits.js</div>
                    <div class="node-desc">CRUD produits (5 routes)</div>
                </div>
                
                <div class="node node-module" id="routesFiches" data-connects="configNode,utilsNode,tableProduits">
                    <div class="node-title">ğŸ“ fiches.js</div>
                    <div class="node-desc">GÃ©nÃ©ration HTML (3 routes)</div>
                </div>
                
                <div class="node node-module" id="routesTendances" data-connects="configNode,tableActualites">
                    <div class="node-title">ğŸ“° tendances.js</div>
                    <div class="node-desc">CRUD actualitÃ©s</div>
                    <div class="node-badge">+alias</div>
                </div>
                
                <div class="node node-module" id="routesContent" data-connects="configNode,tableActualites,tableTech,tableMarche,tableInsights,tablePred">
                    <div class="node-title">ğŸ”€ content.js</div>
                    <div class="node-desc">Contenu par catÃ©gorie</div>
                </div>
                
                <div class="node node-module" id="routesTech" data-connects="configNode,tableTech">
                    <div class="node-title">ğŸ’» technologies.js</div>
                    <div class="node-desc">CRUD technologies</div>
                </div>
                
                <div class="node node-module" id="routesMarche" data-connects="configNode,tableMarche">
                    <div class="node-title">ğŸ“Š marche.js</div>
                    <div class="node-desc">CRUD marchÃ©</div>
                </div>
                
                <div class="node node-module" id="routesInsights" data-connects="configNode,tableInsights">
                    <div class="node-title">ğŸ’¡ insights.js</div>
                    <div class="node-desc">CRUD insights</div>
                </div>
                
                <div class="node node-module" id="routesPred" data-connects="configNode,tablePred">
                    <div class="node-title">ğŸ”® predictions.js</div>
                    <div class="node-desc">CRUD prÃ©dictions</div>
                </div>
                
                <div class="column-title" style="background: linear-gradient(135deg, #7E57C2, #5E35B1); color: white; margin-top: 20px;">
                    ğŸ› ï¸ Utilitaires
                </div>
                
                <div class="node node-utils" id="utilsNode">
                    <div class="node-title">ğŸ”§ ficheGenerator.js</div>
                    <div class="node-desc">generateFicheHTML()<br>createFiche()<br>deleteFiche()</div>
                </div>
            </div>
            
            <!-- Database Column -->
            <div class="flow-column layer-database layer-all">
                <div class="column-title database-title">ğŸ—„ï¸ PostgreSQL</div>
                
                <div class="node node-table" id="dbNode">
                    <div class="node-title">ğŸ’¾ gamer_2025</div>
                    <div class="node-desc">Base de donnÃ©es</div>
                </div>
                
                <div class="node node-table" id="tableProduits">
                    <div class="node-title">ğŸ“¦ produits</div>
                    <div class="node-desc">61 produits</div>
                </div>
                
                <div class="node node-table" id="tableActualites">
                    <div class="node-title">ğŸ“° actualites</div>
                    <div class="node-desc">ActualitÃ©s secteur</div>
                </div>
                
                <div class="node node-table" id="tableTech">
                    <div class="node-title">ğŸ’» technologies</div>
                    <div class="node-desc">Tech Ã©mergentes</div>
                </div>
                
                <div class="node node-table" id="tableMarche">
                    <div class="node-title">ğŸ“Š marche</div>
                    <div class="node-desc">DonnÃ©es marchÃ©</div>
                </div>
                
                <div class="node node-table" id="tableInsights">
                    <div class="node-title">ğŸ’¡ insights</div>
                    <div class="node-desc">Analyses</div>
                </div>
                
                <div class="node node-table" id="tablePred">
                    <div class="node-title">ğŸ”® predictions</div>
                    <div class="node-desc">PrÃ©visions</div>
                </div>
                
                <div class="node node-table" id="tableCategories">
                    <div class="node-title">ğŸ“ categories</div>
                    <div class="node-desc">Types produits</div>
                </div>
            </div>
            
            <!-- Scripts Column -->
            <div class="flow-column layer-scripts layer-all">
                <div class="column-title scripts-title">ğŸ“œ Scripts OrganisÃ©s</div>
                
                <div class="node node-script" data-connects="configNode">
                    <div class="node-title">ğŸ”§ setup/ (5)</div>
                    <div class="node-desc">reinit-db.js<br>restore-db.js</div>
                </div>
                
                <div class="node node-script" data-connects="configNode">
                    <div class="node-title">ğŸ“¦ products/ (11)</div>
                    <div class="node-desc">add-new-products.js<br>update-top-decembre.js</div>
                </div>
                
                <div class="node node-script" data-connects="configNode">
                    <div class="node-title">ğŸ“ fiches/ (6)</div>
                    <div class="node-desc">regenerate-all-fiches.js<br>generate-new-products.js</div>
                </div>
                
                <div class="node node-script" data-connects="configNode">
                    <div class="node-title">ğŸ”§ maintenance/ (35)</div>
                    <div class="node-desc">verify-database-state.js<br>normalize-*.js</div>
                </div>
                
                <div class="node" style="background: linear-gradient(135deg, #90CAF9, #42A5F5); color: white;">
                    <div class="node-title">ğŸ¯ 51 scripts migrÃ©s</div>
                    <div class="node-desc">Utilisent database.js centralisÃ©</div>
                    <div class="node-badge">âœ… Done</div>
                </div>
            </div>
            
            <!-- Tests Column -->
            <div class="flow-column layer-tests layer-all">
                <div class="column-title tests-title">âœ… Tests (Jest)</div>
                
                <div class="node node-test" data-connects="routesProduits,routesFiches,routesTendances">
                    <div class="node-title">ğŸ§ª api.test.js</div>
                    <div class="node-desc">6 tests<br>Endpoints API</div>
                    <div class="node-badge">âœ… Pass</div>
                </div>
                
                <div class="node node-test" data-connects="configNode">
                    <div class="node-title">ğŸ§ª database.test.js</div>
                    <div class="node-desc">3 tests<br>Connexion pool</div>
                    <div class="node-badge">âœ… Pass</div>
                </div>
                
                <div class="node node-test" data-connects="utilsNode">
                    <div class="node-title">ğŸ§ª generation.test.js</div>
                    <div class="node-desc">6 tests<br>GÃ©nÃ©ration HTML</div>
                    <div class="node-badge">âœ… Pass</div>
                </div>
                
                <div class="node" style="background: linear-gradient(135deg, #66BB6A, #43A047); color: white; border: 3px solid #2E7D32;">
                    <div class="node-title">ğŸ¯ 15/15 Tests</div>
                    <div class="node-desc">Tous les tests passent<br>Jest + Supertest</div>
                    <div class="node-badge">âœ… 100%</div>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <h3>ğŸ¨ LÃ©gende - Architecture Modulaire</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #4A90E2, #357ABD);"></div>
                    <div class="legend-text">
                        <div class="legend-label">Frontend HTML/JS</div>
                        <div class="legend-desc">Interface utilisateur statique</div>
                    </div>
                </div>
                
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #80CBC4, #00897B);"></div>
                    <div class="legend-text">
                        <div class="legend-label">Configuration</div>
                        <div class="legend-desc">database.js + dotenv (NEW)</div>
                    </div>
                </div>
                
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #F48FB1, #E91E63);"></div>
                    <div class="legend-text">
                        <div class="legend-label">Modules Routes</div>
                        <div class="legend-desc">8 fichiers modulaires (NEW)</div>
                    </div>
                </div>
                
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #B39DDB, #7E57C2);"></div>
                    <div class="legend-text">
                        <div class="legend-label">Utilitaires</div>
                        <div class="legend-desc">ficheGenerator.js (NEW)</div>
                    </div>
                </div>
                
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #FFF59D, #FBC02D);"></div>
                    <div class="legend-text">
                        <div class="legend-label">Tables PostgreSQL</div>
                        <div class="legend-desc">Base de donnÃ©es gamer_2025</div>
                    </div>
                </div>
                
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #FFCC80, #E67E22);"></div>
                    <div class="legend-text">
                        <div class="legend-label">Scripts OrganisÃ©s</div>
                        <div class="legend-desc">4 dossiers thÃ©matiques (NEW)</div>
                    </div>
                </div>
                
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #AED581, #66BB6A);"></div>
                    <div class="legend-text">
                        <div class="legend-label">Tests AutomatisÃ©s</div>
                        <div class="legend-desc">Jest + Supertest (NEW)</div>
                    </div>
                </div>
                
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #FFE0B2, #FFB74D);"></div>
                    <div class="legend-text">
                        <div class="legend-label">server.js RefactorisÃ©</div>
                        <div class="legend-desc">636 â†’ 260 lignes (-59%)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentFilter = 'all';
        
        // Draw connections between nodes
        function drawConnections() {
            const svg = document.getElementById('connectionsSvg');
            svg.innerHTML = '';
            
            const container = document.querySelector('.flow-container');
            const containerRect = container.getBoundingClientRect();
            
            document.querySelectorAll('.node[data-connects]').forEach(node => {
                const connects = node.dataset.connects;
                if (!connects) return;
                
                const nodeRect = node.getBoundingClientRect();
                const x1 = nodeRect.right - containerRect.left;
                const y1 = nodeRect.top + nodeRect.height / 2 - containerRect.top;
                
                connects.split(',').forEach(targetId => {
                    const target = document.getElementById(targetId.trim());
                    if (!target || target.offsetParent === null) return;
                    
                    const targetRect = target.getBoundingClientRect();
                    const x2 = targetRect.left - containerRect.left;
                    const y2 = targetRect.top + targetRect.height / 2 - containerRect.top;
                    
                    // Create curved path
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const midX = (x1 + x2) / 2;
                    const d = `M ${x1} ${y1} Q ${midX} ${y1}, ${midX} ${(y1 + y2) / 2} T ${x2} ${y2}`;
                    
                    path.setAttribute('d', d);
                    path.setAttribute('class', 'connection-line');
                    path.setAttribute('data-from', node.id || 'unknown');
                    path.setAttribute('data-to', targetId.trim());
                    
                    svg.appendChild(path);
                    
                    // Add arrow
                    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    const angle = Math.atan2(y2 - y1, x2 - x1);
                    const arrowSize = 8;
                    const arrowX = x2 - 10;
                    const arrowY = y2;
                    
                    const points = [
                        [arrowX, arrowY],
                        [arrowX - arrowSize * Math.cos(angle - Math.PI / 6), arrowY - arrowSize * Math.sin(angle - Math.PI / 6)],
                        [arrowX - arrowSize * Math.cos(angle + Math.PI / 6), arrowY - arrowSize * Math.sin(angle + Math.PI / 6)]
                    ].map(p => p.join(',')).join(' ');
                    
                    arrow.setAttribute('points', points);
                    arrow.setAttribute('class', 'connection-arrow');
                    arrow.setAttribute('data-from', node.id || 'unknown');
                    arrow.setAttribute('data-to', targetId.trim());
                    
                    svg.appendChild(arrow);
                });
            });
        }
        
        function filterLayer(layer) {
            currentFilter = layer;
            
            // Remove active class from all buttons
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Show/hide columns based on layer
            const columns = document.querySelectorAll('.flow-column');
            columns.forEach(column => {
                if (layer === 'all' || column.classList.contains('layer-' + layer)) {
                    column.style.display = 'flex';
                } else {
                    column.style.display = 'none';
                }
            });
            
            // Redraw connections after filter change
            setTimeout(drawConnections, 100);
        }
        
        // Add hover effects
        document.querySelectorAll('.node').forEach(node => {
            node.addEventListener('mouseenter', function() {
                const nodeId = this.id;
                const connects = this.dataset.connects;
                
                if (connects) {
                    connects.split(',').forEach(id => {
                        const target = document.getElementById(id.trim());
                        if (target) {
                            target.classList.add('active');
                        }
                        
                        // Highlight connections
                        document.querySelectorAll(`[data-from="${nodeId}"][data-to="${id.trim()}"], [data-to="${nodeId}"][data-from="${id.trim()}"]`).forEach(conn => {
                            conn.classList.add('active');
                        });
                    });
                }
                
                // Highlight incoming connections
                document.querySelectorAll(`[data-to="${nodeId}"]`).forEach(conn => {
                    conn.classList.add('active');
                    const fromId = conn.getAttribute('data-from');
                    const fromNode = document.getElementById(fromId);
                    if (fromNode) fromNode.classList.add('active');
                });
            });
            
            node.addEventListener('mouseleave', function() {
                document.querySelectorAll('.node').forEach(n => {
                    n.classList.remove('active');
                });
                document.querySelectorAll('.connection-line, .connection-arrow').forEach(conn => {
                    conn.classList.remove('active');
                });
            });
        });
        
        // Initial draw and redraw on window resize
        window.addEventListener('load', drawConnections);
        window.addEventListener('resize', drawConnections);
        
        // Redraw on scroll (for dynamic positioning)
        let scrollTimeout;
        document.querySelector('.flow-container').addEventListener('scroll', function() {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(drawConnections, 50);
        });
    </script>
</body>
</html>
