digraph SiteGamer2025 {
    rankdir=TB;
    node [shape=box, style=filled, fontname="Arial", fontsize=10];
    
    // FRONTEND LAYER
    subgraph cluster_frontend {
        label="ðŸŽ¨ FRONTEND (Static HTML/CSS/JS)";
        style=filled;
        color="#E3F2FD";
        fontsize=12;
        
        HTML [label="ðŸ“„ HTML Pages\nindex.html\ntendances.html\ntop-du-mois.html", fillcolor="#FFF9C4"];
        CSS [label="ðŸŽ¨ Styles\nstyles.css\nstyles.min.css", fillcolor="#FFF9C4"];
        JS [label="âš¡ JavaScript\nfiches.js/min.js\ntendances.js/min.js\nfiche-produit.js/min.js", fillcolor="#FFF9C4"];
    }
    
    // BACKEND LAYER - Modular Architecture
    subgraph cluster_backend {
        label="ðŸš€ BACKEND (Node.js + Express - Modulaire)";
        style=filled;
        color="#C8E6C9";
        fontsize=12;
        
        Server [label="âš™ï¸ server.js\n(260 lignes)\nExpress App", fillcolor="#FFE0B2", shape=component];
        
        subgraph cluster_config {
            label="âš¡ Configuration";
            style=filled;
            color="#B2DFDB";
            
            Config [label="ðŸ”§ database.js\nPool PostgreSQL\n+ dotenv", fillcolor="#80CBC4"];
            Env [label="ðŸ” .env\nCredentials\n(gitignored)", fillcolor="#80CBC4"];
        }
        
        subgraph cluster_routes {
            label="ðŸ›£ï¸ Routes (/backend/routes)";
            style=filled;
            color="#F8BBD0";
            
            R_Produits [label="ðŸ“¦ produits.js\nCRUD produits", fillcolor="#F48FB1"];
            R_Fiches [label="ðŸ“ fiches.js\nGÃ©nÃ©ration/suppression", fillcolor="#F48FB1"];
            R_Tendances [label="ðŸ“° tendances.js\nCRUD actualitÃ©s\n(+alias /actualites)", fillcolor="#F48FB1"];
            R_Content [label="ðŸ”€ content.js\nContenu par catÃ©gorie", fillcolor="#F48FB1"];
            R_Tech [label="ðŸ’» technologies.js\nCRUD", fillcolor="#F48FB1"];
            R_Marche [label="ðŸ“Š marche.js\nCRUD", fillcolor="#F48FB1"];
            R_Insights [label="ðŸ’¡ insights.js\nCRUD", fillcolor="#F48FB1"];
            R_Predictions [label="ðŸ”® predictions.js\nCRUD", fillcolor="#F48FB1"];
        }
        
        subgraph cluster_utils {
            label="ðŸ› ï¸ Utilitaires";
            style=filled;
            color="#D1C4E9";
            
            Utils [label="ðŸ”§ ficheGenerator.js\ngenerateFicheHTML()\ncreateFiche()\ndeleteFiche()\nreadFiche()", fillcolor="#B39DDB"];
        }
    }
    
    // SCRIPTS LAYER - Organized
    subgraph cluster_scripts {
        label="ðŸ“œ SCRIPTS (OrganisÃ©s)";
        style=filled;
        color="#FFE0B2";
        fontsize=12;
        
        S_Setup [label="ðŸ”§ setup/\n(5 scripts)\nreinit-db.js\nrestore-db.js", fillcolor="#FFCC80"];
        S_Products [label="ðŸ“¦ products/\n(11 scripts)\nadd-new-products.js\nupdate-top-decembre.js", fillcolor="#FFCC80"];
        S_Fiches [label="ðŸ“ fiches/\n(6 scripts)\nregenerate-all-fiches.js\ngenerate-new-products.js", fillcolor="#FFCC80"];
        S_Maintenance [label="ðŸ”§ maintenance/\n(35 scripts)\nverify-database-state.js\nnormalize-*.js", fillcolor="#FFCC80"];
    }
    
    // DATABASE LAYER
    subgraph cluster_database {
        label="ðŸ—„ï¸ DATABASE (PostgreSQL)";
        style=filled;
        color="#FFF9C4";
        fontsize=12;
        
        DB [label="ðŸ’¾ PostgreSQL\ngamer_2025", fillcolor="#FDD835", shape=cylinder];
        
        T_Produits [label="ðŸ“¦ produits\n(61 produits)\nid, nom, categorie,\nprix, donnees_fiche...", fillcolor="#FFEB3B"];
        T_Actualites [label="ðŸ“° actualites\ntitre, description,\ndate, tags, categorie_id", fillcolor="#FFEB3B"];
        T_Technologies [label="ðŸ’» technologies", fillcolor="#FFEB3B"];
        T_Marche [label="ðŸ“Š marche", fillcolor="#FFEB3B"];
        T_Insights [label="ðŸ’¡ insights", fillcolor="#FFEB3B"];
        T_Predictions [label="ðŸ”® predictions", fillcolor="#FFEB3B"];
        T_Categories [label="ðŸ“ categories", fillcolor="#FFEB3B"];
    }
    
    // TESTS LAYER
    subgraph cluster_tests {
        label="âœ… TESTS (Jest + Supertest)";
        style=filled;
        color="#C5E1A5";
        fontsize=12;
        
        T_API [label="ðŸ§ª api.test.js\n6 tests\nEndpoints API", fillcolor="#AED581"];
        T_DB [label="ðŸ§ª database.test.js\n3 tests\nConnexion pool", fillcolor="#AED581"];
        T_Gen [label="ðŸ§ª generation.test.js\n6 tests\nGÃ©nÃ©ration HTML", fillcolor="#AED581"];
        T_Result [label="âœ… 15/15 tests\npassent", fillcolor="#66BB6A", shape=note];
    }
    
    // OUTPUT LAYER
    subgraph cluster_output {
        label="ðŸ“ OUTPUT (Fichiers gÃ©nÃ©rÃ©s)";
        style=filled;
        color="#B2EBF2";
        fontsize=12;
        
        StaticFiches [label="ðŸ“„ Fiches HTML\nfiches/categorie/*.html\n(gÃ©nÃ©rÃ©es dynamiquement)", fillcolor="#80DEEA"];
    }
    
    // === FLUX PRINCIPAUX ===
    
    // Frontend -> Server
    HTML -> Server [label="HTTP Request", color="#2196F3", penwidth=2];
    JS -> Server [label="fetch() calls", color="#2196F3", penwidth=2];
    CSS -> HTML [label="styles", color="#9E9E9E"];
    JS -> HTML [label="<script>", color="#9E9E9E"];
    
    // Server -> Configuration
    Server -> Config [label="require()", color="#4CAF50", penwidth=2];
    Config -> Env [label="load", color="#4CAF50"];
    
    // Server -> Routes (montage)
    Server -> R_Produits [label="app.use('/api/produits')", color="#E91E63"];
    Server -> R_Fiches [label="app.use('/api')", color="#E91E63"];
    Server -> R_Tendances [label="app.use('/api/tendances')", color="#E91E63"];
    Server -> R_Tendances [label="app.use('/api/actualites')", color="#E91E63", style=dashed];
    Server -> R_Content [label="app.use('/api')", color="#E91E63"];
    Server -> R_Tech [label="app.use('/api/technologies')", color="#E91E63"];
    Server -> R_Marche [label="app.use('/api/marche')", color="#E91E63"];
    Server -> R_Insights [label="app.use('/api/insights')", color="#E91E63"];
    Server -> R_Predictions [label="app.use('/api/predictions')", color="#E91E63"];
    
    // Routes -> Database via Config
    Config -> DB [label="pool connection", color="#4CAF50", penwidth=2];
    R_Produits -> T_Produits [label="SQL queries", color="#FF9800"];
    R_Fiches -> T_Produits [label="read data", color="#FF9800"];
    R_Tendances -> T_Actualites [label="SQL CRUD", color="#FF9800"];
    R_Content -> T_Actualites [label="queries", color="#FF9800"];
    R_Content -> T_Technologies [label="queries", color="#FF9800"];
    R_Content -> T_Marche [label="queries", color="#FF9800"];
    R_Content -> T_Insights [label="queries", color="#FF9800"];
    R_Content -> T_Predictions [label="queries", color="#FF9800"];
    R_Tech -> T_Technologies [label="SQL CRUD", color="#FF9800"];
    R_Marche -> T_Marche [label="SQL CRUD", color="#FF9800"];
    R_Insights -> T_Insights [label="SQL CRUD", color="#FF9800"];
    R_Predictions -> T_Predictions [label="SQL CRUD", color="#FF9800"];
    
    // Routes -> Utilitaires
    R_Fiches -> Utils [label="use", color="#9C27B0"];
    Utils -> StaticFiches [label="write HTML", color="#9C27B0", penwidth=2];
    
    // Database organization
    DB -> T_Produits [style=invis];
    DB -> T_Actualites [style=invis];
    DB -> T_Technologies [style=invis];
    DB -> T_Marche [style=invis];
    DB -> T_Insights [style=invis];
    DB -> T_Predictions [style=invis];
    DB -> T_Categories [style=invis];
    
    // Scripts -> Database
    S_Setup -> Config [label="require()", color="#795548"];
    S_Products -> Config [label="require()", color="#795548"];
    S_Fiches -> Config [label="require()", color="#795548"];
    S_Maintenance -> Config [label="require()", color="#795548"];
    
    // Tests -> Modules
    T_API -> R_Produits [label="test", color="#4CAF50", style=dashed];
    T_API -> R_Fiches [label="test", color="#4CAF50", style=dashed];
    T_API -> R_Tendances [label="test", color="#4CAF50", style=dashed];
    T_DB -> Config [label="test", color="#4CAF50", style=dashed];
    T_Gen -> Utils [label="test", color="#4CAF50", style=dashed];
    T_API -> T_Result [style=invis];
    T_DB -> T_Result [style=invis];
    T_Gen -> T_Result [style=invis];
    
    // Output -> Frontend
    StaticFiches -> HTML [label="served", color="#00BCD4"];
    R_Produits -> JS [label="JSON response", color="#00BCD4"];
    R_Tendances -> JS [label="JSON response", color="#00BCD4"];
    
    // LÃ©gende
    Legend [label="ðŸŽ¯ ARCHITECTURE MODULAIRE\n\nâœ… 8 modules routes\nâœ… Config centralisÃ©e (dotenv)\nâœ… 51 scripts migrÃ©s\nâœ… 57 scripts organisÃ©s\nâœ… 15 tests passants\nâœ… Server.js: 636â†’260 lignes (-59%)", 
            shape=note, fillcolor="#E8F5E9", fontsize=11];
}
