<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflows - Site Gamer 2025</title>
    <link rel="stylesheet" href="wiki-styles.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f0f1e; color: #e0e0e0; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 50px 20px; text-align: center; box-shadow: 0 5px 30px rgba(102, 126, 234, 0.4); }
        .header h1 { font-size: 3em; color: white; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .nav { background: rgba(102, 126, 234, 0.1); padding: 15px 20px; border-bottom: 1px solid #667eea; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .nav a { color: #667eea; text-decoration: none; margin-right: 25px; transition: all 0.3s; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; }
        .nav a:hover { color: #764ba2; transform: translateY(-2px); }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .section { margin-bottom: 50px; background: linear-gradient(145deg, #2a2a40, #1f1f35); border: 2px solid #667eea; border-radius: 15px; padding: 30px; }
        .section h2 { color: #667eea; margin-bottom: 20px; font-size: 2em; }
        .section h3 { color: #2ecc71; margin: 25px 0 15px; font-size: 1.4em; }
        .step { background: rgba(102, 126, 234, 0.1); border-left: 4px solid #667eea; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .step-number { display: inline-block; background: #667eea; color: white; width: 35px; height: 35px; border-radius: 50%; text-align: center; line-height: 35px; font-weight: 700; margin-right: 10px; }
        code { background: rgba(102, 126, 234, 0.2); padding: 3px 8px; border-radius: 4px; font-family: 'Courier New', monospace; color: #ffd700; }
        pre { background: #1a1a2e; padding: 20px; border-radius: 10px; overflow-x: auto; margin: 15px 0; border: 1px solid #667eea; }
        pre code { background: none; padding: 0; color: #2ecc71; }
        .warning { background: rgba(243, 156, 18, 0.1); border-left: 4px solid #f39c12; padding: 15px; margin: 20px 0; border-radius: 8px; }
        .info { background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498db; padding: 15px; margin: 20px 0; border-radius: 8px; }
        .success { background: rgba(46, 204, 113, 0.1); border-left: 4px solid #2ecc71; padding: 15px; margin: 20px 0; border-radius: 8px; }
        .back-link { display: inline-block; margin-top: 30px; padding: 12px 25px; background: #667eea; color: white; border-radius: 8px; text-decoration: none; transition: all 0.3s; }
        .back-link:hover { background: #764ba2; transform: translateY(-2px); }
        .footer { text-align: center; margin-top: 60px; padding: 30px; border-top: 1px solid rgba(102, 126, 234, 0.3); opacity: 0.7; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîÑ Workflows</h1>
        <p>Processus et guides √©tape par √©tape</p>
    </div>

    <nav class="nav">
        <a href="wiki.html">üè† Accueil Wiki</a>
        <a href="api-reference.html">üìÅ API</a>
        <a href="database.html">üóÑÔ∏è Base de donn√©es</a>
        <a href="scripts.html">‚öôÔ∏è Scripts</a>
        <a href="troubleshooting.html">üîß D√©pannage</a>
        <a href="changelog.html">üìù Changelog</a>
    </nav>

    <div class="container">
        <div class="section">
            <h2>‚ûï Ajouter un nouveau produit</h2>

            <div class="step">
                <span class="step-number">1</span>
                <strong>Pr√©parer les donn√©es</strong>
                <p style="margin: 10px 0 0 45px;">Rassembler les informations compl√®tes du produit :</p>
                <ul style="margin: 10px 0 0 65px;">
                    <li>Nom et cat√©gorie</li>
                    <li>Description et sp√©cifications</li>
                    <li>Prix au format <code>"XXX.XX‚Ç¨"</code></li>
                    <li>Fonctionnalit√©s avanc√©es (3-5 items)</li>
                    <li>Sections d√©taill√©es pour <code>donnees_fiche</code></li>
                    <li>Image du produit</li>
                </ul>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Ajouter l'image</strong>
                <pre><code># Copier l'image dans le bon dossier
cp image-produit.jpg frontend/public/assets/images/

# V√©rifier le format du nom (lowercase, tirets)
# Exemple: iphone-15-pro.jpg</code></pre>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Cr√©er le produit via API</strong>
                <pre><code>// POST /api/produits
fetch('http://localhost:3000/api/produits', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        nom: "iPhone 15 Pro",
        categorie: "Smartphone",
        description: "Le smartphone le plus puissant...",
        prix: "1229.00‚Ç¨",
        specifications: "Puce A17 Pro, 128 Go...",
        fonctionnalites_avancees: [
            "Puce A17 Pro",
            "Cam√©ra 48MP",
            "√âcran ProMotion 120Hz",
            "Titane a√©rospatial"
        ],
        donnees_fiche: [
            {
                "titre": "Design et √âcran",
                "contenu": "Le nouvel iPhone 15 Pro..."
            },
            {
                "titre": "Performance",
                "contenu": "La puce A17 Pro..."
            }
        ],
        image: "iphone-15-pro.jpg",
        top_du_mois: false
    })
})
.then(r => r.json())
.then(data => console.log('Produit cr√©√©:', data));</code></pre>
            </div>

            <div class="info">
                <strong>üí° Auto-g√©n√©ration ID :</strong>
                <p style="margin-top: 10px;">L'API attribue automatiquement un ID au format <code>prod_XX</code> en incr√©mentant le dernier ID existant.</p>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>G√©n√©rer la fiche HTML</strong>
                <pre><code># R√©cup√©rer l'ID du produit cr√©√© (ex: prod_62)
curl -X POST http://localhost:3000/api/generate-fiche/prod_62</code></pre>
                <p style="margin: 10px 0 0 45px;">La fiche est g√©n√©r√©e dans <code>fiches/{categorie}/{slug}.html</code></p>
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>V√©rifier le r√©sultat</strong>
                <pre><code># V√©rifier en base
node scripts/check-prod62.js

# Acc√©der √† la fiche
http://localhost:3000/fiches/smartphone/iphone-15-pro.html</code></pre>
            </div>
        </div>

        <div class="section">
            <h2>‚úèÔ∏è Modifier un produit existant</h2>

            <div class="step">
                <span class="step-number">1</span>
                <strong>R√©cup√©rer le produit</strong>
                <pre><code>const response = await fetch('http://localhost:3000/api/produits/prod_50');
const product = await response.json();
console.log(product);</code></pre>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Modifier les donn√©es</strong>
                <pre><code>// Modifier les champs souhait√©s
product.prix = "1299.00‚Ç¨";
product.description = "Nouvelle description...";
product.fonctionnalites_avancees.push("Nouvelle fonctionnalit√©");</code></pre>
            </div>

            <div class="warning">
                <strong>‚ö†Ô∏è Important :</strong>
                <p style="margin-top: 10px;">Le PUT doit inclure TOUS les champs. Ne jamais envoyer un objet partiel.</p>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Envoyer la mise √† jour</strong>
                <pre><code>await fetch('http://localhost:3000/api/produits/prod_50', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(product) // Objet complet
});</code></pre>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>R√©g√©n√©rer la fiche</strong>
                <pre><code>curl -X POST http://localhost:3000/api/generate-fiche/prod_50</code></pre>
            </div>
        </div>

        <div class="section">
            <h2>üìÖ Workflow "Top du mois"</h2>

            <h3>D√©but de mois : D√©finir les nouveaux tops</h3>

            <div class="step">
                <span class="step-number">1</span>
                <strong>Backup de la DB</strong>
                <pre><code>pg_dump -U postgres gamer_2025 > backup_avant_top_$(date +%Y%m).sql</code></pre>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Pr√©parer le script de mise √† jour</strong>
                <p style="margin: 10px 0 0 45px;">√âditer <code>scripts/set-top-janvier.js</code> (ou mois correspondant) :</p>
                <pre><code>const topProducts = [
    'prod_62', // iPhone 15 Pro
    'prod_63', // Samsung S24 Ultra
    'prod_64', // PS5 Slim
    // ... 12 produits au total
];

// Le script va:
// 1. Mettre top_du_mois = false pour tous
// 2. Mettre top_du_mois = true pour ces IDs
// 3. R√©g√©n√©rer leurs fiches</code></pre>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Ex√©cuter le script</strong>
                <pre><code>node scripts/set-top-janvier.js</code></pre>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>V√©rifier les r√©sultats</strong>
                <pre><code>node scripts/verify-database-state.js

# V√©rifier page d'accueil
http://localhost:3000/</code></pre>
            </div>

            <div class="success">
                <strong>‚úÖ Fr√©quence :</strong>
                <p style="margin-top: 10px;">Ce workflow est ex√©cut√© une fois par mois, typiquement le 1er ou 2 du mois.</p>
            </div>
        </div>

        <div class="section">
            <h2>üîÑ R√©g√©n√©ration massive de fiches</h2>

            <h3>Cas d'usage</h3>
            <ul style="margin-left: 20px;">
                <li>Apr√®s modification du template HTML</li>
                <li>Apr√®s changement des styles CSS</li>
                <li>Apr√®s normalisation des donn√©es</li>
                <li>Apr√®s correction de bugs d'affichage</li>
            </ul>

            <div class="step">
                <span class="step-number">1</span>
                <strong>Choisir le script appropri√©</strong>
                <pre><code># Toutes les fiches (peut prendre plusieurs minutes)
node scripts/regenerate-all-fiches.js

# Seulement les tops du mois (12 fiches)
node scripts/regenerate-fiches-top.js

# Fiches normalis√©es uniquement
node scripts/regenerate-normalized-fiches.js</code></pre>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Surveiller l'ex√©cution</strong>
                <p style="margin: 10px 0 0 45px;">Les scripts affichent une progression :</p>
                <pre><code>G√©n√©ration des fiches...
‚úì prod_1 - ASUS ROG Strix G15
‚úì prod_2 - iPhone 14 Pro
‚úì prod_3 - PlayStation 5
...
‚úÖ 61 fiches g√©n√©r√©es avec succ√®s!</code></pre>
            </div>

            <div class="warning">
                <strong>‚ö†Ô∏è Performance :</strong>
                <p style="margin-top: 10px;">La g√©n√©ration de toutes les fiches peut prendre 2-3 minutes. Le serveur doit √™tre en cours d'ex√©cution.</p>
            </div>
        </div>

        <div class="section">
            <h2>üìä Normalisation des donn√©es</h2>

            <h3>Quand normaliser</h3>
            <ul style="margin-left: 20px;">
                <li>Apr√®s import massif de donn√©es</li>
                <li>D√©tection d'incoh√©rences dans les formats</li>
                <li>Migration depuis ancien syst√®me</li>
                <li>Correction de cat√©gories mal format√©es</li>
            </ul>

            <div class="step">
                <span class="step-number">1</span>
                <strong>Backup obligatoire</strong>
                <pre><code>pg_dump -U postgres gamer_2025 > backup_avant_normalisation.sql</code></pre>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Identifier les probl√®mes</strong>
                <pre><code>node scripts/verify-database-state.js</code></pre>
                <p style="margin: 10px 0 0 45px;">Chercher dans l'output :</p>
                <ul style="margin: 10px 0 0 65px;">
                    <li>Cat√©gories avec espaces ou majuscules</li>
                    <li>Prix mal format√©s</li>
                    <li>Chemins d'images absolus</li>
                    <li>Espaces dans les liens</li>
                </ul>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Ex√©cuter les scripts de normalisation</strong>
                <pre><code># Par cat√©gorie
node scripts/normalize-smartphone.js
node scripts/normalize-camera.js
node scripts/normalize-ecran-tv.js

# Fixes g√©n√©riques
node scripts/fix-descriptions-and-specs.js
node scripts/fix-prices-back.js
node scripts/clean-donnees-fiche.js</code></pre>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>V√©rifier les r√©sultats</strong>
                <pre><code>node scripts/verify-database-state.js</code></pre>
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>R√©g√©n√©rer les fiches</strong>
                <pre><code>node scripts/regenerate-all-fiches.js</code></pre>
            </div>
        </div>

        <div class="section">
            <h2>üèóÔ∏è Workflow d√©veloppement frontend</h2>

            <div class="step">
                <span class="step-number">1</span>
                <strong>Cr√©er une branche</strong>
                <pre><code>git checkout -b feature/nouvelle-page</code></pre>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>D√©velopper</strong>
                <pre><code># D√©marrer serveur dev avec hot reload
npm run dev

# √âditer les fichiers
# frontend/public/nouvelle-page.html
# frontend/public/assets/css/styles.css
# frontend/public/assets/js/main.js</code></pre>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Tester</strong>
                <p style="margin: 10px 0 0 45px;">Ouvrir <code>http://localhost:3000/nouvelle-page.html</code></p>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Build production</strong>
                <pre><code>npm run build:css
npm run build:js</code></pre>
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>Commit et push</strong>
                <pre><code>git add frontend/
git commit -m "feat: Add nouvelle page"
git push origin feature/nouvelle-page</code></pre>
            </div>

            <div class="step">
                <span class="step-number">6</span>
                <strong>Pull Request et merge</strong>
                <p style="margin: 10px 0 0 45px;">Cr√©er PR sur GitHub, review, puis merge vers main</p>
            </div>
        </div>

        <div class="section">
            <h2>üêõ Workflow correction de bug</h2>

            <div class="step">
                <span class="step-number">1</span>
                <strong>Reproduire le bug</strong>
                <p style="margin: 10px 0 0 45px;">Comprendre et documenter le probl√®me</p>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Identifier la source</strong>
                <pre><code># Logs serveur
pm2 logs

# Logs DB
sudo tail -f /var/log/postgresql/postgresql-14-main.log

# Console navigateur
F12 ‚Üí Console</code></pre>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Cr√©er branche hotfix</strong>
                <pre><code>git checkout -b hotfix/fix-price-format</code></pre>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Corriger et tester</strong>
                <p style="margin: 10px 0 0 45px;">Modifier le code, tester localement</p>
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>D√©ployer rapidement</strong>
                <pre><code>git commit -m "fix: Correct price format validation"
git push origin hotfix/fix-price-format

# Merge et d√©ployer imm√©diatement si critique</code></pre>
            </div>

            <div class="step">
                <span class="step-number">6</span>
                <strong>Documenter</strong>
                <p style="margin: 10px 0 0 45px;">Ajouter le fix dans le changelog et la doc troubleshooting</p>
            </div>
        </div>

        <a href="wiki.html" class="back-link">‚Üê Retour au Wiki</a>
    </div>

    <div class="footer">
        <p>üîÑ Workflows - Site Gamer 2025</p>
        <p>Derni√®re mise √† jour : 26 d√©cembre 2025</p>
    </div>
</body>
</html>
