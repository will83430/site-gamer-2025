<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©pannage - Site Gamer 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Orbitron:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="wiki-styles.css">
    <style>
        h1 { font-family: 'Orbitron', sans-serif; color: #d4ff00; display: inline-block; min-width: max-content; }
        h2 { font-family: 'Orbitron', sans-serif; color: #d4ff00; }
    </style>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #0a0a0f; color: #e0e0e0; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #1a1a2a 0%, #121220 100%); border-bottom: 2px solid #d4ff00; padding: 50px 20px; text-align: center; box-shadow: 0 0 30px rgba(212, 255, 0, 0.2); }
        .header h1 { font-size: 3em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; color: #b0b0c0; opacity: 0.9; }
        .nav { background: rgba(212, 255, 0, 0.1); padding: 15px 20px; border-bottom: 1px solid #d4ff00; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .nav a { color: #d4ff00; text-decoration: none; margin-right: 25px; transition: all 0.3s; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; }
        .nav a:hover { color: #6bff6b; transform: translateY(-2px); }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .section { margin-bottom: 50px; background: linear-gradient(145deg, #2a2a40, #1f1f35); border: 2px solid #667eea; border-radius: 15px; padding: 30px; }
        .section h2 { color: #d4ff00; margin-bottom: 20px; font-size: 2em; display: flex; align-items: center; gap: 10px; }
        .section h3 { color: #2ecc71; margin: 25px 0 15px; font-size: 1.4em; }
        .problem { background: rgba(231, 76, 60, 0.1); border-left: 4px solid #e74c3c; padding: 15px; margin: 20px 0; border-radius: 5px; }
        .problem-title { color: #e74c3c; font-weight: 600; margin-bottom: 10px; font-size: 1.1em; }
        .solution { background: rgba(46, 204, 113, 0.1); border-left: 4px solid #2ecc71; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .solution-title { color: #2ecc71; font-weight: 600; margin-bottom: 10px; }
        code { background: rgba(102, 126, 234, 0.2); padding: 3px 8px; border-radius: 4px; font-family: 'Courier New', monospace; color: #ffd700; }
        pre { background: #1a1a2e; padding: 20px; border-radius: 10px; overflow-x: auto; margin: 15px 0; border: 1px solid #667eea; }
        pre code { background: none; padding: 0; }
        .tip { background: rgba(255, 193, 7, 0.1); border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .tip-title { color: #ffc107; font-weight: 600; margin-bottom: 10px; }
        .command { background: #1a1a2e; padding: 10px 15px; border-radius: 5px; font-family: monospace; margin: 10px 0; border: 1px solid #667eea; }
        .back-link { display: inline-block; margin-top: 30px; padding: 12px 25px; background: #667eea; display: inline-block; min-width: max-content; border-radius: 8px; text-decoration: none; transition: all 0.3s; }
        .back-link:hover { background: #764ba2; transform: translateY(-2px); }
        .toc { background: rgba(212, 255, 0, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 30px; }
        .toc h3 { color: #d4ff00; margin-bottom: 15px; }
        .toc ul { list-style: none; }
        .toc li { margin: 8px 0; }
        .toc a { color: #e0e0e0; text-decoration: none; transition: color 0.3s; }
        .toc a:hover { color: #d4ff00; }
        .footer { text-align: center; margin-top: 60px; padding: 30px; border-top: 1px solid rgba(102, 126, 234, 0.3); opacity: 0.7; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß D√©pannage</h1>
        <p>Solutions aux probl√®mes courants du Site Gamer 2025</p>
    </div>

    <nav class="nav">
        <a href="wiki.html">üè† Accueil Wiki</a>
        <a href="api-reference.html">üìÅ API</a>
        <a href="database.html">üóÑÔ∏è Base de donn√©es</a>
        <a href="scripts.html">‚öôÔ∏è Scripts</a>
        <a href="troubleshooting.html">üîß D√©pannage</a>
        <a href="changelog.html">üìù Changelog</a>
    </nav>

    <div class="container">
        <div class="toc">
            <h3>üìë Table des mati√®res</h3>
            <ul>
                <li><a href="#database">üêò Probl√®mes de base de donn√©es</a></li>
                <li><a href="#server">üñ•Ô∏è Probl√®mes serveur</a></li>
                <li><a href="#fiches">üìÑ Probl√®mes de g√©n√©ration de fiches</a></li>
                <li><a href="#api">üîå Erreurs API</a></li>
                <li><a href="#images">üñºÔ∏è Probl√®mes d'images</a></li>
                <li><a href="#scripts">‚öôÔ∏è Probl√®mes de scripts</a></li>
                <li><a href="#frontend">üåê Probl√®mes frontend</a></li>
            </ul>
        </div>

        <!-- Database Issues -->
        <div class="section" id="database">
            <h2>üêò Probl√®mes de base de donn√©es</h2>

            <h3>Connexion refus√©e</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Erreur : "connection refused" ou "ECONNREFUSED"</div>
                <p>Le serveur ne parvient pas √† se connecter √† PostgreSQL.</p>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solutions :</div>
                <ol>
                    <li>V√©rifiez que PostgreSQL est d√©marr√© :
                        <div class="command">services.msc</div>
                        Recherchez "postgresql" et assurez-vous qu'il est d√©marr√©.
                    </li>
                    <li>V√©rifiez les credentials dans <code>server.js</code> :
                        <pre><code>user: 'postgres'
database: 'gamer_2025'
password: 'XXXXXX'</code></pre>
                    </li>
                    <li>Testez la connexion avec le script de v√©rification :
                        <div class="command">node quick-check.js</div>
                    </li>
                </ol>
            </div>

            <h3>Base de donn√©es inexistante</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Erreur : database "gamer_2025" does not exist</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Cr√©ez la base de donn√©es et restaurez les donn√©es :</p>
                <pre><code>-- Depuis psql
CREATE DATABASE gamer_2025;
\c gamer_2025

-- Puis ex√©cutez le fichier SQL
\i backend/gestion_produits.sql</code></pre>
                <p>Ou utilisez le script de restauration :</p>
                <div class="command">node restore-backup.js</div>
            </div>

            <h3>Donn√©es manquantes ou corrompues</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Produits manquants ou donn√©es incoh√©rentes</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>V√©rifiez l'√©tat de la base de donn√©es :</p>
                <div class="command">node scripts/verify-database-state.js</div>
                <p>Pour restaurer les donn√©es :</p>
                <div class="command">node scripts/restore-db.js</div>
            </div>

            <div class="tip">
                <div class="tip-title">üí° Conseil :</div>
                <p>Faites r√©guli√®rement des backups avec <code>pg_dump</code> :</p>
                <div class="command">pg_dump -U postgres gamer_2025 > backup_$(date +%Y%m%d).sql</div>
            </div>
        </div>

        <!-- Server Issues -->
        <div class="section" id="server">
            <h2>üñ•Ô∏è Probl√®mes serveur</h2>

            <h3>Serveur ne d√©marre pas</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Le serveur ne d√©marre pas ou crash imm√©diatement</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solutions :</div>
                <ol>
                    <li>V√©rifiez que le port 3000 n'est pas d√©j√† utilis√© :
                        <div class="command">netstat -ano | findstr :3000</div>
                    </li>
                    <li>V√©rifiez les d√©pendances :
                        <div class="command">npm install</div>
                    </li>
                    <li>V√©rifiez la version de Node.js (18+ requis) :
                        <div class="command">node --version</div>
                    </li>
                    <li>D√©marrez en mode d√©veloppement pour voir les erreurs :
                        <div class="command">npm run dev</div>
                    </li>
                </ol>
            </div>

            <h3>CORS errors</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Erreurs CORS dans le navigateur</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Le serveur est configur√© avec des headers CORS permissifs dans <code>server.js</code>. Si le probl√®me persiste, v√©rifiez que la requ√™te provient bien du bon domaine et que les headers sont correctement d√©finis.</p>
            </div>

            <h3>Routes statiques ne fonctionnent pas</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Les fichiers statiques retournent 404</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>V√©rifiez l'ordre des middlewares dans <code>server.js</code>. L'ordre est important :</p>
                <pre><code>1. /assets ‚Üí frontend/public/assets
2. /frontend/public ‚Üí frontend/public
3. /fiches ‚Üí fiches/
4. / ‚Üí project root</code></pre>
                <p>Les routes API doivent √™tre d√©clar√©es AVANT les gestionnaires statiques.</p>
            </div>
        </div>

        <!-- Fiches Issues -->
        <div class="section" id="fiches">
            <h2>üìÑ Probl√®mes de g√©n√©ration de fiches</h2>

            <h3>G√©n√©ration √©choue</h3>
            <div class="problem">
                <div class="problem-title">‚ùå POST /api/generate-fiche/:id retourne une erreur 500</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solutions :</div>
                <ol>
                    <li>V√©rifiez que le produit existe :
                        <div class="command">curl http://localhost:3000/api/produits/prod_50</div>
                    </li>
                    <li>V√©rifiez que les dossiers de cat√©gories existent dans <code>fiches/</code></li>
                    <li>V√©rifiez les permissions d'√©criture dans le dossier <code>fiches/</code></li>
                    <li>Testez la g√©n√©ration pour un produit sp√©cifique :
                        <div class="command">node scripts/generate-new-products.js</div>
                    </li>
                </ol>
            </div>

            <h3>Fiche g√©n√©r√©e avec donn√©es manquantes</h3>
            <div class="problem">
                <div class="problem-title">‚ùå La fiche HTML est cr√©√©e mais certaines donn√©es sont vides</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>V√©rifiez la structure des donn√©es du produit :</p>
                <div class="command">node scripts/check-prod1.js</div>
                <p>Assurez-vous que tous les champs requis sont pr√©sents :</p>
                <ul>
                    <li><code>nom</code>, <code>categorie</code>, <code>description_courte</code></li>
                    <li><code>prix</code> (format: "999.99‚Ç¨")</li>
                    <li><code>donnees_fiche</code> (array avec sections compl√®tes)</li>
                    <li><code>fonctionnalites_avancees</code> (array)</li>
                </ul>
            </div>

            <h3>Mauvais nom de fichier ou chemin</h3>
            <div class="problem">
                <div class="problem-title">‚ùå La fiche est g√©n√©r√©e avec un nom ou chemin incorrect</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Le nom de fichier est slugifi√© depuis <code>product.nom</code>. V√©rifiez :</p>
                <ul>
                    <li>Le nom ne contient pas de caract√®res sp√©ciaux probl√©matiques</li>
                    <li>La cat√©gorie est en minuscules avec espaces remplac√©s par tirets</li>
                    <li>Le champ <code>categorie</code> correspond exactement √† un dossier dans <code>fiches/</code></li>
                </ul>
            </div>

            <div class="tip">
                <div class="tip-title">üí° Conseil :</div>
                <p>Pour r√©g√©n√©rer toutes les fiches en une fois :</p>
                <div class="command">node scripts/regenerate-all-fiches.js</div>
                <p>Pour r√©g√©n√©rer seulement les produits du mois :</p>
                <div class="command">node scripts/regenerate-fiches-top.js</div>
            </div>
        </div>

        <!-- API Issues -->
        <div class="section" id="api">
            <h2>üîå Erreurs API</h2>

            <h3>PUT /api/produits/:id √©choue</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Erreur lors de la mise √† jour d'un produit</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Le PUT requiert TOUS les champs du produit, pas seulement ceux √† modifier :</p>
                <ol>
                    <li>R√©cup√©rez d'abord le produit complet avec GET</li>
                    <li>Modifiez les champs souhait√©s</li>
                    <li>Renvoyez l'objet complet avec PUT</li>
                </ol>
                <p>Exemple :</p>
                <pre><code>// 1. GET
const product = await fetch('/api/produits/prod_50').then(r => r.json());

// 2. Modifier
product.top_du_mois = true;

// 3. PUT avec TOUT l'objet
await fetch('/api/produits/prod_50', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(product)
});</code></pre>
            </div>

            <h3>Arrays mal format√©s</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Erreurs avec fonctionnalites_avancees ou donnees_fiche</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Ces champs doivent √™tre des arrays JavaScript, pas des strings :</p>
                <pre><code>// ‚úÖ Correct
{
    "fonctionnalites_avancees": ["Feature 1", "Feature 2"],
    "donnees_fiche": [
        { "titre": "Section", "contenu": "..." }
    ]
}

// ‚ùå Incorrect
{
    "fonctionnalites_avancees": "{Feature 1,Feature 2}"
}</code></pre>
            </div>

            <h3>Cat√©gorie non reconnue</h3>
            <div class="problem">
                <div class="problem-title">‚ùå GET /api/:categorie/actualites retourne 404</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Les cat√©gories sont match√©es en lowercase. Utilisez exactement les noms de la table <code>categories</code> :</p>
                <ul>
                    <li>smartphone</li>
                    <li>tablette</li>
                    <li>pc-gaming</li>
                    <li>console</li>
                    <li>etc.</li>
                </ul>
            </div>
        </div>

        <!-- Images Issues -->
        <div class="section" id="images">
            <h2>üñºÔ∏è Probl√®mes d'images</h2>

            <h3>Image ne s'affiche pas</h3>
            <div class="problem">
                <div class="problem-title">‚ùå L'image du produit ne s'affiche pas (404)</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solutions :</div>
                <ol>
                    <li>V√©rifiez que l'image existe dans <code>frontend/public/assets/images/</code></li>
                    <li>Le champ <code>image</code> dans la DB doit contenir SEULEMENT le nom du fichier, pas le chemin complet :
                        <pre><code>// ‚úÖ Correct
"image": "iphone-15-pro.jpg"

// ‚ùå Incorrect
"image": "assets/images/iphone-15-pro.jpg"
"image": "/assets/images/iphone-15-pro.jpg"</code></pre>
                    </li>
                    <li>Le serveur g√©n√®re automatiquement <code>image_url</code> : <code>/assets/images/${image}</code></li>
                    <li>Si l'image manque, le placeholder sera utilis√© : <code>/assets/images/placeholder.png</code></li>
                </ol>
            </div>

            <h3>T√©l√©charger des images</h3>
            <div class="tip">
                <div class="tip-title">üí° Conseil :</div>
                <p>Utilisez les scripts de t√©l√©chargement d'images :</p>
                <div class="command">node scripts/download-camera-images.js</div>
                <p>Puis mettez √† jour les produits avec les nouveaux noms de fichiers.</p>
            </div>
        </div>

        <!-- Scripts Issues -->
        <div class="section" id="scripts">
            <h2>‚öôÔ∏è Probl√®mes de scripts</h2>

            <h3>Script ne trouve pas la DB</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Les scripts retournent des erreurs de connexion</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Tous les scripts utilisent les m√™mes credentials. V√©rifiez que PostgreSQL est accessible avec :</p>
                <ul>
                    <li>user: <code>postgres</code></li>
                    <li>database: <code>gamer_2025</code></li>
                    <li>password: <code>XXXXXX</code></li>
                </ul>
                <p>Si vous avez chang√© ces valeurs, mettez √† jour tous les scripts qui importent <code>pg</code>.</p>
            </div>

            <h3>Probl√®me avec fetch dans les scripts</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Erreur : "fetch is not defined"</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Node.js 18+ inclut fetch nativement. V√©rifiez votre version :</p>
                <div class="command">node --version</div>
                <p>Si &lt; 18, mettez √† jour Node.js ou installez node-fetch.</p>
            </div>

            <h3>Script g√©n√®re des donn√©es incorrectes</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Les scripts de normalisation modifient mal les donn√©es</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Avant de normaliser, v√©rifiez toujours l'√©tat actuel :</p>
                <div class="command">node scripts/verify-database-state.js</div>
                <p>Faites un backup avant toute modification majeure :</p>
                <div class="command">pg_dump -U postgres gamer_2025 > backup_avant_normalisation.sql</div>
            </div>
        </div>

        <!-- Frontend Issues -->
        <div class="section" id="frontend">
            <h2>üåê Probl√®mes frontend</h2>

            <h3>Build CSS/JS √©choue</h3>
            <div class="problem">
                <div class="problem-title">‚ùå npm run build:css ou build:js retourne une erreur</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solutions :</div>
                <ol>
                    <li>V√©rifiez que les outils sont install√©s :
                        <div class="command">npm install</div>
                    </li>
                    <li>Les fichiers sources existent :
                        <ul>
                            <li><code>frontend/public/assets/css/*.css</code></li>
                            <li><code>frontend/public/assets/js/*.js</code></li>
                        </ul>
                    </li>
                    <li>Nettoyez et rebuilddez :
                        <div class="command">npm run clean && npm run build:css && npm run build:js</div>
                    </li>
                </ol>
            </div>

            <h3>Fichiers minifi√©s non charg√©s</h3>
            <div class="problem">
                <div class="problem-title">‚ùå Les fichiers .min.css ou .min.js ne sont pas trouv√©s</div>
            </div>
            <div class="solution">
                <div class="solution-title">‚úÖ Solution :</div>
                <p>Apr√®s modification des sources, lancez toujours le build :</p>
                <div class="command">npm run build:css && npm run build:js</div>
                <p>V√©rifiez que les fichiers minifi√©s sont bien cr√©√©s dans <code>frontend/public/assets/</code></p>
            </div>
        </div>

        <!-- Quick Diagnostic -->
        <div class="section">
            <h2>üîç Diagnostic rapide</h2>
            <p>Commandes utiles pour diagnostiquer rapidement :</p>
            
            <h3>V√©rifier l'√©tat g√©n√©ral</h3>
            <div class="command">node quick-check.js</div>
            <p>Teste la connexion DB et affiche quelques produits.</p>

            <h3>V√©rifier la structure des donn√©es</h3>
            <div class="command">node scripts/verify-database-state.js</div>
            <p>Contr√¥le l'int√©grit√© des donn√©es (liens, cat√©gories, images, etc.).</p>

            <h3>V√©rifier un produit sp√©cifique</h3>
            <div class="command">node scripts/check-prod50.js</div>
            <p>Affiche tous les d√©tails d'un produit (remplacez 50 par l'ID souhait√©).</p>

            <h3>Tester le serveur</h3>
            <div class="command">node test-server.js</div>
            <p>Lance des tests basiques sur les endpoints API.</p>

            <h3>V√©rifier les sch√©mas</h3>
            <div class="command">node scripts/check-schemas.js</div>
            <p>V√©rifie la structure des tables PostgreSQL.</p>
        </div>

        <div class="tip">
            <div class="tip-title">üí° Besoin d'aide suppl√©mentaire ?</div>
            <p>Si votre probl√®me n'est pas list√© ici :</p>
            <ol>
                <li>Consultez la <a href="api-reference.html" style="color: #d4ff00;">r√©f√©rence API</a></li>
                <li>V√©rifiez la <a href="database.html" style="color: #d4ff00;">documentation de la base de donn√©es</a></li>
                <li>Examinez les logs du serveur en mode d√©veloppement : <code>npm run dev</code></li>
                <li>Consultez les <a href="workflows.html" style="color: #d4ff00;">workflows</a> pour les processus complets</li>
            </ol>
        </div>

        <a href="wiki.html" class="back-link">‚Üê Retour au Wiki</a>
    </div>

    <div class="footer">
        <p>üîß D√©pannage - Site Gamer 2025</p>
        <p>Derni√®re mise √† jour : 26 d√©cembre 2025</p>
    </div>
</body>
</html>
