<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin PostgreSQL - Gestion Compl√®te avec Images</title>
    
    <!-- Lien vers le fichier CSS externe -->
    <link rel="stylesheet" href="assets/css/admin-styles.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üéØ Interface Admin PostgreSQL</h1>
            <p style="color: #666;">Gestion compl√®te avec images locales</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-products">0</div>
                <div class="stat-label">üì¶ Total Produits</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-categories">0</div>
                <div class="stat-label">üìÇ Cat√©gories</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="featured-products">0</div>
                <div class="stat-label">‚≠ê Top du mois</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('list')">üìã Liste des Produits</button>
            <button class="tab-btn" onclick="showTab('create')">‚ûï Cr√©er un Produit</button>
            <button class="tab-btn" onclick="showTab('modify')">‚úèÔ∏è Modifier un Produit</button>
        </div>

        <!-- Message Container -->
        <div id="message-container"></div>

        <!-- Tab: Liste des Produits -->
        <div id="list-tab" class="tab-content active">
            <h2 style="margin-bottom: 20px;">üìã Tous les Produits</h2>

            <div style="overflow-x: auto;">
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>ID</th>
                            <th>Nom</th>
                            <th>Cat√©gorie</th>
                            <th>Prix</th>
                            <th>Top</th>
                            <th>Actions</th>
                            <th>Fiche</th> <!-- NOUVELLE COLONNE -->
                        </tr>
                    </thead>
                    <tbody id="products-list">
                        <tr>
                            <td colspan="8" style="text-align: center;">Chargement...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Onglet CR√âER UN PRODUIT -->
        <div id="create-tab" class="tab-content">
            <h2 style="margin-bottom: 20px;">‚ûï Cr√©er un Nouveau Produit</h2>
            <form id="create-form" onsubmit="createProduct(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nom du produit *</label>
                        <input type="text" id="new-nom" required oninput="autoFillFichePath('new')">
                    </div>

                    <div class="form-group">
                        <label>Cat√©gorie *</label>
                        <select id="new-categorie" required onchange="updateCategoryFields('new');autoFillFichePath('new')">
                            <option value="">-- Choisir --</option>
                            <option value="DRONE">DRONE</option>
                            <option value="CONSOLE">CONSOLE</option>
                            <option value="TABLETTE">TABLETTE</option>
                            <option value="SMARTPHONE">SMARTPHONE</option>
                            <option value="PC GAMING">PC GAMING</option>
                            <option value="SERVEUR">SERVEUR</option>
                            <option value="CASQUE AUDIO">CASQUE AUDIO</option>
                            <option value="MONTRE CONNECTEE">MONTRE CONNECTEE</option>
                            <option value="CASQUE VR">CASQUE VR</option>
                            <option value="IMPRIMANTE 3D">IMPRIMANTE 3D</option>
                            <option value="ECRAN TV">ECRAN TV</option>
                            <option value="CAMERA">CAMERA</option>
                            <option value="PERIPHERIQUES">PERIPHERIQUES</option>
                            <option value="VIDEO PROJECTEUR">VIDEO PROJECTEUR</option>
                            <option value="BOX INTERNET">BOX INTERNET</option>
                            <option value="TABLEAU INTERACTIF">TABLEAU INTERACTIF</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Prix</label>
                        <input type="text" id="new-prix" placeholder="Ex: 1299‚Ç¨">
                    </div>

                    <div class="form-group">
                        <label>Top du mois</label>
                        <select id="new-top">
                            <option value="false">Non</option>
                            <option value="true">Oui ‚≠ê</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Description courte</label>
                    <textarea id="new-description" rows="3"></textarea>
                </div>

                <!-- Zone d'upload d'image MODERNE - VERSION PROPRE -->
                <div class="form-group">
                    <label>Image du produit</label>
                    
                    <!-- Zone de drag & drop principale -->
                    <div class="upload-zone" id="new-upload-zone">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Glissez votre image ici</div>
                        <div class="upload-hint">ou cliquez pour parcourir (JPG, PNG, WebP - Max 5MB)</div>
                        <input type="file" id="new-image-file" accept="image/*" style="display: none;">
                    </div>
                    
                    <!-- Conteneur pour la pr√©visualisation -->
                    <div id="new-preview-container"></div>
                </div>

                <div class="form-group">
                    <label>Fichier de fiche produit (HTML local)</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="new-lien" placeholder="Ex: fiches/drone/mavic-pro.html" style="flex: 1;">
                        <label class="file-label" style="margin: 0;">
                            üìÅ Parcourir
                            <input type="file" id="new-fiche-file" accept=".html,.htm"
                                onchange="handleFicheSelect(event, 'new')" style="display: none;">
                        </label>
                        <button type="button" class="btn btn-info" onclick="showFicheSelector('new')">
                            üìÇ Liste des fiches
                        </button>
                    </div>
                    <small style="color: #888;">Entrez le chemin relatif ou s√©lectionnez depuis la liste</small>
                    <div id="new-fiche-selector"
                        style="display: none; margin-top: 10px; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px;">
                        <!-- La liste des fichiers sera charg√©e ici -->
                    </div>
                </div>

                <div class="form-group">
                    <label>Fonctionnalit√©s avanc√©es (une par ligne)</label>
                    <textarea id="new-fonctionnalites" rows="5"></textarea>
                </div>

                <div class="form-group">
                    <label>Titre affich√© (optionnel)</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="new-titre-affiche" placeholder="Ex: Asus ROG Strix G18" style="flex: 1;">
                        <button type="button" class="btn btn-info"
                            onclick="document.getElementById('new-titre-affiche').value = formatTitreAffiche(document.getElementById('new-nom').value)">
                            üîÑ Auto
                        </button>
                    </div>
                </div>

                <div id="new-category-fields">
                    <!-- Les champs sp√©cifiques √† la cat√©gorie seront ajout√©s ici -->
                </div>

                <div style="margin-top: 30px;">
                    <button type="submit" class="btn btn-success">
                        üíæ Cr√©er le Produit
                    </button>
                    <button type="button" class="btn btn-primary" onclick="saveProductAndGenerateFiche('new')">
                        üöÄ Cr√©er + G√©n√©rer Fiche
                    </button>
                     <button type="button" class="btn btn-info" onclick="previewGeneratedFiche('new')">
                        üìÑ Aper√ßu Fiche HTML
                    </button>
                    <button type="button" class="btn btn-warning" onclick="resetCreateForm()">
                        üîÑ R√©initialiser
                    </button>
                </div>
            </form>
        </div>

        <!-- Onglet MODIFIER UN PRODUIT -->
        <div id="modify-tab" class="tab-content">
            <h2 style="margin-bottom: 20px;">‚úèÔ∏è Modifier un Produit</h2>
            <div class="form-group">
                <label>S√©lectionner un produit</label>
                <select id="edit-product-select" onchange="loadProductForEdit()">
                    <option value="">-- Choisir un produit --</option>
                </select>
            </div>
            <div id="edit-form-container" style="display: none;">
                <form id="edit-form" onsubmit="updateProduct(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nom du produit *</label>
                            <input type="text" id="edit-nom" required oninput="autoFillFichePath('edit')">
                        </div>

                        <div class="form-group">
                            <label>Cat√©gorie *</label>
                            <select id="edit-categorie" required
                                onchange="updateCategoryFields('edit');autoFillFichePath('edit')">
                                <option value="">-- Choisir --</option>
                                <option value="DRONE">DRONE</option>
                                <option value="CONSOLE">CONSOLE</option>
                                <option value="TABLETTE">TABLETTE</option>
                                <option value="SMARTPHONE">SMARTPHONE</option>
                                <option value="PC GAMING">PC GAMING</option>
                                <option value="SERVEUR">SERVEUR</option>
                                <option value="CASQUE AUDIO">CASQUE AUDIO</option>
                                <option value="MONTRE CONNECTEE">MONTRE CONNECTEE</option>
                                <option value="CASQUE VR">CASQUE VR</option>
                                <option value="IMPRIMANTE 3D">IMPRIMANTE 3D</option>
                                <option value="ECRAN TV">ECRAN TV</option>
                                <option value="CAMERA">CAMERA</option>
                                <option value="PERIPHERIQUES">PERIPHERIQUES</option>
                                <option value="VIDEO PROJECTEUR">VIDEO PROJECTEUR</option>
                                <option value="BOX INTERNET">BOX INTERNET</option>
                                <option value="TABLEAU INTERACTIF">TABLEAU INTERACTIF</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Prix</label>
                            <input type="text" id="edit-prix" placeholder="Ex: 1299‚Ç¨">
                        </div>

                        <div class="form-group">
                            <label>Top du mois</label>
                            <select id="edit-top">
                                <option value="false">Non</option>
                                <option value="true">Oui ‚≠ê</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Description courte</label>
                        <textarea id="edit-description" rows="3"></textarea>
                    </div>

                    <!-- Zone d'upload d'image MODERNE - CORRECTION EDIT -->
                    <div class="form-group">
                        <label>Image du produit</label>
                        
                        <!-- Affichage de l'image actuelle -->
                        <div id="edit-current-image" style="display: none; margin-bottom: 20px; text-align: center; background: #f8f9fa; padding: 20px; border-radius: 15px; border: 2px dashed #e0e0e0;">
                            <p style="color: #667eea; font-size: 16px; margin-bottom: 15px; font-weight: 600;">
                                üì∑ Image actuelle du produit
                            </p>
                            <div style="position: relative; display: inline-block;">
                                <img id="edit-current-img" 
                                     style="max-width: 300px; height: 200px; object-fit: cover; border-radius: 12px; border: 3px solid #ddd; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <div style="position: absolute; bottom: -30px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; white-space: nowrap;">
                                    üîç Cliquez pour agrandir
                                </div>
                            </div>
                        </div>
                        
                        <!-- Zone de drag & drop pour nouvelle image -->
                        <div class="upload-zone" id="edit-upload-zone">
                            <div class="upload-icon">üìÅ</div>
                            <div class="upload-text">Glissez une nouvelle image ici</div>
                            <div class="upload-hint">ou cliquez pour parcourir (JPG, PNG, WebP - Max 5MB)</div>
                            <input type="file" id="edit-image-file" accept="image/*" style="display: none;">
                        </div>
                        
                        <!-- Conteneur pour la nouvelle image s√©lectionn√©e -->
                        <div id="edit-preview-container"></div>
                        
                        <!-- Bouton pour supprimer l'image -->
                        <div id="edit-image-actions" style="display: none; text-align: center; margin-top: 10px;">
                            <button type="button" onclick="removeImage('edit')" class="btn btn-danger">
                                üóëÔ∏è Supprimer l'image
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Fichier de fiche produit (HTML local)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="edit-lien" placeholder="Ex: fiches/smartphone/iphone15.html"
                                style="flex: 1;">
                            <label class="file-label" style="margin: 0;">
                                üìÅ Parcourir
                                <input type="file" id="edit-fiche-file" accept=".html,.htm"
                                    onchange="handleFicheSelect(event, 'edit')" style="display: none;">
                            </label>
                            <button type="button" class="btn btn-info" onclick="showFicheSelector('edit')">
                                üìÇ Liste des fiches
                            </button>
                        </div>
                        <small style="color: #888;">Entrez le chemin relatif ou s√©lectionnez depuis la liste</small>
                        <div id="edit-fiche-selector"
                            style="display: none; margin-top: 10px; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px;">
                            <!-- La liste des fichiers sera charg√©e ici -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Fonctionnalit√©s avanc√©es (une par ligne)</label>
                        <textarea id="edit-fonctionnalites" rows="5"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Titre affich√© (optionnel)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="edit-titre-affiche" placeholder="Ex: Asus ROG Strix G18" style="flex: 1;">
                            <button type="button" class="btn btn-info"
                                onclick="document.getElementById('edit-titre-affiche').value = formatTitreAffiche(document.getElementById('edit-nom').value)">
                                üîÑ Auto
                            </button>
                        </div>
                    </div>

                    <div id="edit-category-fields">
                        <!-- Les champs sp√©cifiques √† la cat√©gorie seront ajout√©s ici -->
                    </div>

                    <div style="margin-top: 30px;">
                        <button type="button" class="btn btn-info" onclick="previewGeneratedFiche('edit')">
                            üìÑ Aper√ßu Fiche HTML
                        </button>
                        <button type="submit" class="btn btn-primary">
                            üíæ Sauvegarder
                        </button>
                        <button type="button" class="btn btn-success" onclick="saveProductAndGenerateFiche('edit')">
                            üöÄ Sauvegarder + G√©n√©rer Fiche
                        </button>
                        <button type="button" class="btn btn-danger" onclick="deleteProduct()">
                            üóëÔ∏è Supprimer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de pr√©visualisation -->
    <div id="previewModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closePreview()">&times;</span>
            <div id="fichePreview"></div>
        </div>
    </div>

    <script src="assets/js/admin-gestion-produits.js"></script>
</body>

</html>