<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Modernisation des fiches HTML</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #2196F3;
            padding-bottom: 10px;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h3 {
            margin-top: 0;
            color: #555;
        }
        textarea {
            width: 100%;
            height: 500px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            box-sizing: border-box;
            resize: vertical;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #1976D2;
        }
        .success {
            background: #4CAF50;
        }
        .success:hover {
            background: #45a049;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .json-output {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .status.success {
            display: block;
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            display: block;
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>üîÑ Modernisation des fiches produits HTML</h1>
    
    <div class="info-box">
        <strong>Instructions :</strong><br>
        1. Collez le code HTML de votre ancienne fiche dans la zone de gauche<br>
        2. Cliquez sur "Moderniser la fiche"<br>
        3. Le nouveau code HTML appara√Ætra √† droite<br>
        4. Les donn√©es extraites seront affich√©es pour le JSON
    </div>

    <div class="container">
        <div class="panel">
            <h3>üìÑ Ancienne fiche (HTML statique)</h3>
            <textarea id="input" placeholder="Collez ici le code HTML complet de votre ancienne fiche..."></textarea>
            <button onclick="moderniserFiche()">üöÄ Moderniser la fiche</button>
            <button class="success" onclick="copierNouveau()">üìã Copier le nouveau HTML</button>
        </div>
        
        <div class="panel">
            <h3>‚ú® Nouvelle fiche (HTML dynamique)</h3>
            <textarea id="output" placeholder="Le nouveau code HTML appara√Ætra ici..." readonly></textarea>
            <div class="status" id="status"></div>
        </div>
    </div>

    <div class="panel" style="margin-top: 20px;">
        <h3>üìä Donn√©es extraites pour le JSON</h3>
        <div class="json-output" id="jsonOutput">
            Les donn√©es JSON extraites appara√Ætront ici...
        </div>
        <button onclick="copierJSON()">üìã Copier les donn√©es JSON</button>
    </div>

    <script>
        function moderniserFiche() {
            const input = document.getElementById('input').value;
            if (!input.trim()) {
                afficherStatut('Veuillez coller le code HTML de votre ancienne fiche', 'error');
                return;
            }

            try {
                // Parser le HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(input, 'text/html');
                
                // Extraire les donn√©es
                const titre = doc.querySelector('h1')?.textContent.trim() || 'Titre non trouv√©';
                
                // Trouver la description (premier paragraphe apr√®s le badge)
                let description = '';
                const allP = doc.querySelectorAll('p');
                for (let p of allP) {
                    if (!p.textContent.includes('üí∞') && 
                        !p.textContent.includes('üß©') && 
                        !p.textContent.includes('üé•') &&
                        !p.textContent.includes('üñ•Ô∏è') &&
                        !p.textContent.includes('üïπÔ∏è') &&
                        !p.textContent.includes('üåê') && 
                        !p.textContent.includes('üéÆ')) {
                        description = p.textContent.trim();
                        break;
                    }
                }

                // Extraire les paragraphes avec emojis
                const paragraphes = [];
                allP.forEach(p => {
                    const text = p.innerHTML;
                    if (text.includes('üí∞') || 
                        text.includes('üß©') || 
                        text.includes('üé•') ||
                        text.includes('üñ•Ô∏è') ||
                        text.includes('üïπÔ∏è') ||
                        text.includes('üåê') || 
                        text.includes('üéÆ')) {
                        // Remplacer les <br> par des \n pour le JSON
                        paragraphes.push(text.replace(/<br>/g, '\\n'));
                    }
                });

                // Cr√©er l'objet JSON
                const donneesProduit = {
                    nom: titre,
                    description: description,
                    categorie: "gaming", // √Ä ajuster selon vos besoins
                    image: `assets/images/${titre}.png`, // √Ä ajuster
                    top_du_mois: false, // √Ä d√©finir
                    donnees_fiche: [description, ...paragraphes]
                };

                // Afficher les donn√©es JSON
                document.getElementById('jsonOutput').textContent = JSON.stringify(donneesProduit, null, 2);

                // Cr√©er le nouveau HTML
                const nouveauHTML = `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>${titre}</title>
    <link rel="stylesheet" href="../../assets/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Manrope&family=Montserrat&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="entete">
        <img src="../../assets/images/gaming.png" alt="Gaming">
        <a href="../../top-du-mois.html">Retour √† la vitrine</a>
    </div>

    <h1>${titre}</h1>

    <div id="badge-top-mois"></div>

    <p class="description">${description}</p>

    <div class="gallery">
        <img src="../../assets/images/placeholder.png" alt="${titre}" class="img-centree">
    </div>
    <div class="lightbox" id="lightbox">
        <img id="lightbox-img" src="" alt="Zoom">
    </div>

    <!-- Les paragraphes seront remplis dynamiquement -->
    <div id="product-content">
        <!-- Le contenu sera inject√© ici par JavaScript -->
    </div>

    <script>
        const g = document.querySelector(".gallery img");
        const l = document.getElementById("lightbox");
        const z = document.getElementById("lightbox-img");
        if (g) {
            g.addEventListener("click", () => {
                l.style.display = "flex";
                z.src = g.src;
            });
            l.addEventListener("click", () => (l.style.display = "none"));
        }

        const nomProduit = document.querySelector("h1").textContent.trim();

        // Charger et afficher TOUTES les donn√©es depuis le JSON
        fetch("../../data/equipements.json")
            .then((res) => res.json())
            .then((data) => {
                const produit = data.equipements
                    ? data.equipements.find((p) => p.nom === nomProduit)
                    : data.find((p) => p.nom === nomProduit);

                if (produit) {
                    console.log("Produit trouv√©:", produit);

                    // Badge top du mois
                    if (produit.top_du_mois) {
                        document.getElementById("badge-top-mois").innerHTML = \`
                        <div style="background:#ffde59;padding:8px;margin-bottom:10px;text-align:center;border-radius:8px;">
                            ‚≠ê Ce produit est en vedette ce mois-ci !
                        </div>\`;
                    }

                    // Mettre √† jour la description
                    const description = document.querySelector(".description");
                    if (description && produit.description) {
                        description.textContent = produit.description;
                    }

                    // Mettre √† jour l'image
                    if (produit.image) {
                        const img = document.querySelector(".gallery img");
                        if (img) {
                            img.src = "../../" + produit.image;
                            img.alt = produit.nom;
                        }
                    }

                    // IMPORTANT : Cr√©er dynamiquement tous les paragraphes depuis donnees_fiche
                    const contentDiv = document.getElementById("product-content");
                    if (contentDiv && produit.donnees_fiche && produit.donnees_fiche.length > 0) {
                        contentDiv.innerHTML = "";

                        // Cr√©er un paragraphe pour chaque donn√©e (sauf la premi√®re qui est la description)
                        produit.donnees_fiche.forEach((donnee, index) => {
                            if (index > 0) {
                                const p = document.createElement("p");
                                p.innerHTML = donnee
                                    .replace(/\\\\n/g, "<br>")
                                    .replace(/\\n/g, "<br>");
                                contentDiv.appendChild(p);
                            }
                        });
                    } else {
                        // Template par d√©faut si pas de donn√©es
                        const contentDiv = document.getElementById("product-content");
                        contentDiv.innerHTML = \`
                        <p>üí∞ Prix : √Ä D√âFINIR ‚Ç¨</p>
                        <p>üß© Sp√©cifications : √Ä REMPLIR</p>
                        <p>üåê Fonctionnalit√©s : √Ä REMPLIR</p>
                        <p>üéÆ Exp√©rience : √Ä REMPLIR</p>\`;
                    }
                } else {
                    console.log("Produit non trouv√© dans le JSON");
                    // Afficher le contenu par d√©faut
                    document.getElementById("product-content").innerHTML = \`
                    <p>üí∞ Prix : √Ä D√âFINIR ‚Ç¨</p>
                    <p>üß© Sp√©cifications : √Ä REMPLIR</p>
                    <p>üåê Fonctionnalit√©s : √Ä REMPLIR</p>
                    <p>üéÆ Exp√©rience : √Ä REMPLIR</p>\`;
                }
            })
            .catch((err) => {
                console.error("Erreur chargement JSON :", err);
                document.getElementById("product-content").innerHTML = \`
                <p>üí∞ Prix : √Ä D√âFINIR ‚Ç¨</p>
                <p>üß© Sp√©cifications : √Ä REMPLIR</p>
                <p>üåê Fonctionnalit√©s : √Ä REMPLIR</p>
                <p>üéÆ Exp√©rience : √Ä REMPLIR</p>\`;
            });
    <\/script>

    <footer class="footer">
        <img src="../../assets/images/banniere-pied.png" alt="Banni√®re" class="footer-banner">
        <div class="footer-links">
            <div class="footer-item">
                <img src="../../assets/images/logo-blanc.png" alt="Accueil" class="footer-icon">
                <a href="../../index.html">Accueil</a>
            </div>
            <div class="footer-item">
                <img src="../../assets/images/logo-dokk-blanc.png" alt="Multibloc" class="footer-icon">
                <a href="equipements.html">√âquipements</a>
            </div>
        </div>
    </footer>
</body>
<script src="../../assets/js/utils.js"><\/script>
</html>`;

                document.getElementById('output').value = nouveauHTML;
                afficherStatut('‚úÖ Fiche modernis√©e avec succ√®s !', 'success');

            } catch (error) {
                afficherStatut('‚ùå Erreur lors de la modernisation : ' + error.message, 'error');
                console.error(error);
            }
        }

        function afficherStatut(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
        }

        function copierNouveau() {
            const output = document.getElementById('output');
            output.select();
            document.execCommand('copy');
            afficherStatut('‚úÖ Nouveau HTML copi√© dans le presse-papier !', 'success');
        }

        function copierJSON() {
            const jsonOutput = document.getElementById('jsonOutput');
            const range = document.createRange();
            range.selectNode(jsonOutput);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            afficherStatut('‚úÖ Donn√©es JSON copi√©es dans le presse-papier !', 'success');
        }
    </script>
</body>
</html>