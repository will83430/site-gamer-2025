<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests AutomatisÃ©s - Wiki Site Gamer 2025</title>
    <link rel="stylesheet" href="wiki-styles.css">
</head>
<body>
    <div class="header">
        <h1>ğŸ§ª Tests AutomatisÃ©s</h1>
        <p>Tests Jest pour garantir la qualitÃ© du code</p>
    </div>

    <nav class="nav">
        <a href="wiki.html">ğŸ  Accueil Wiki</a>
        <a href="api-reference.html">ğŸ“ API</a>
        <a href="database.html">ğŸ—„ï¸ Base de donnÃ©es</a>
        <a href="scripts.html">âš™ï¸ Scripts</a>
        <a href="troubleshooting.html">ğŸ”§ DÃ©pannage</a>
        <a href="changelog.html">ğŸ“ Changelog</a>
    </nav>

    <div class="breadcrumb" style="max-width: 1200px; margin: 20px auto; padding: 0 20px; opacity: 0.7;">
        <a href="wiki.html" style="color: #667eea; text-decoration: none;">ğŸ  Wiki</a> > Tests AutomatisÃ©s
    </div>

    <div class="container">
        <div class="content" style="background: linear-gradient(145deg, #2a2a40, #1f1f35); border-radius: 15px; padding: 40px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);">
            
            <h2>ğŸ“‹ Vue d'ensemble</h2>
            
            <div class="info">
                <strong>ğŸ’¡ Info :</strong> Le projet utilise Jest pour les tests automatisÃ©s, garantissant la fiabilitÃ© du code et facilitant la maintenance.
            </div>
            
            <p>Les tests automatisÃ©s sont essentiels pour :</p>
            <ul>
                <li><strong>Garantir la qualitÃ©</strong> - DÃ©tecter les bugs avant la production</li>
                <li><strong>Faciliter les refactoring</strong> - Modifier le code en toute confiance</li>
                <li><strong>Documenter le comportement</strong> - Les tests servent de documentation vivante</li>
                <li><strong>AccÃ©lÃ©rer le dÃ©veloppement</strong> - DÃ©tection rapide des rÃ©gressions</li>
                <li><strong>AmÃ©liorer la maintenabilitÃ©</strong> - Code plus robuste et fiable</li>
            </ul>

            <p style="text-align: center; margin: 30px 0; font-size: 1.2em;">
                <strong style="color: #2ecc71;">âœ… 15 tests</strong> | 
                <strong style="color: #3498db;">3 suites</strong> | 
                <strong style="color: #2ecc71;">100% succÃ¨s</strong>
            </p>

            <h2>ğŸš€ Lancer les tests</h2>

            <h3>Tests standard</h3>
            <p>Lance tous les tests une fois :</p>
            <div class="code-block">
                <div style="background: rgba(102, 126, 234, 0.2); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #667eea;">
                    <span style="color: #2ecc71; font-weight: 600; font-size: 0.85em;">bash</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copier</button>
                </div>
                <code>npm test</code>
            </div>

            <h3>Mode watch (dÃ©veloppement)</h3>
            <p>Lance les tests automatiquement Ã  chaque modification de fichier :</p>
            <div class="code-block">
                <div style="background: rgba(102, 126, 234, 0.2); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #667eea;">
                    <span style="color: #2ecc71; font-weight: 600; font-size: 0.85em;">bash</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copier</button>
                </div>
                <code>npm run test:watch</code>
            </div>
            <div class="info">
                <strong>ğŸ’¡ Astuce :</strong> Utilisez le mode watch pendant le dÃ©veloppement pour un feedback immÃ©diat.
            </div>

            <h3>Couverture de code</h3>
            <p>GÃ©nÃ¨re un rapport de couverture indiquant quelles parties du code sont testÃ©es :</p>
            <div class="code-block">
                <div style="background: rgba(102, 126, 234, 0.2); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #667eea;">
                    <span style="color: #2ecc71; font-weight: 600; font-size: 0.85em;">bash</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copier</button>
                </div>
                <code>npm run test:coverage</code>
            </div>
            <p>Le rapport sera gÃ©nÃ©rÃ© dans <code>coverage/</code> et affichera :</p>
            <ul>
                <li><strong>Statements</strong> - Pourcentage d'instructions exÃ©cutÃ©es</li>
                <li><strong>Branches</strong> - Pourcentage de branches conditionnelles testÃ©es</li>
                <li><strong>Functions</strong> - Pourcentage de fonctions appelÃ©es</li>
                <li><strong>Lines</strong> - Pourcentage de lignes de code exÃ©cutÃ©es</li>
            </ul>

            <h2>ğŸ“¦ Structure des tests</h2>

            <div class="code-block">
                <code>tests/
â”œâ”€â”€ database.test.js      # Tests de connexion PostgreSQL
â”œâ”€â”€ api.test.js           # Tests des endpoints API
â””â”€â”€ generation.test.js    # Tests de gÃ©nÃ©ration de fiches HTML</code>
            </div>

            <h3>1. Tests de base de donnÃ©es (database.test.js)</h3>
            <p><strong>Objectif :</strong> VÃ©rifier la connexion et la configuration PostgreSQL</p>
            <ul>
                <li>âœ… Connexion Ã  la base de donnÃ©es</li>
                <li>âœ… Configuration du pool de connexions</li>
                <li>âœ… RequÃªte simple SELECT 1</li>
            </ul>

            <h3>2. Tests API (api.test.js)</h3>
            <p><strong>Objectif :</strong> Valider les endpoints REST et leurs rÃ©ponses</p>
            <ul>
                <li>âœ… GET /api/produits - Liste des produits</li>
                <li>âœ… GET /api/produits/:id - DÃ©tail d'un produit</li>
                <li>âœ… POST /api/produits - CrÃ©ation d'un produit</li>
                <li>âœ… PUT /api/produits/:id - Modification</li>
                <li>âœ… DELETE /api/produits/:id - Suppression</li>
                <li>âœ… Gestion des erreurs (404, 500)</li>
            </ul>

            <h3>3. Tests de gÃ©nÃ©ration (generation.test.js)</h3>
            <p><strong>Objectif :</strong> Tester la gÃ©nÃ©ration de fiches HTML produits</p>
            <ul>
                <li>âœ… GÃ©nÃ©ration du HTML valide</li>
                <li>âœ… Structure des balises</li>
                <li>âœ… PrÃ©sence des mÃ©tadonnÃ©es</li>
                <li>âœ… Liens vers CSS/JS</li>
                <li>âœ… Slugification des noms</li>
                <li>âœ… CrÃ©ation des dossiers</li>
            </ul>

            <h2>ğŸ” Comprendre les rÃ©sultats</h2>

            <h3>RÃ©sultat typique</h3>
            <div class="code-block">
                <code>PASS  tests/database.test.js
  Database Connection
    âœ“ should connect to PostgreSQL (45ms)
    âœ“ should have correct pool configuration (2ms)
    âœ“ should execute simple query (12ms)

PASS  tests/api.test.js
  API Endpoints
    âœ“ GET /api/produits should return product list (234ms)
    âœ“ GET /api/produits/:id should return specific product (156ms)
    âœ“ POST /api/produits should create new product (189ms)
    âœ“ PUT /api/produits/:id should update product (167ms)
    âœ“ DELETE /api/produits/:id should delete product (143ms)
    âœ“ should return 404 for non-existent product (89ms)

PASS  tests/generation.test.js
  Fiche Generation
    âœ“ should generate valid HTML (76ms)
    âœ“ should include metadata (34ms)
    âœ“ should link CSS and JS files (28ms)
    âœ“ should slugify product names correctly (12ms)
    âœ“ should create category folders (45ms)
    âœ“ should handle special characters (23ms)

Test Suites: 3 passed, 3 total
Tests:       15 passed, 15 total
Snapshots:   0 total
Time:        2.456 s</code>
            </div>

            <h3>Indicateurs de succÃ¨s</h3>
            <table>
                <thead>
                    <tr>
                        <th>Symbole</th>
                        <th>Signification</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span style="color: #2ecc71; font-weight: 600;">âœ“</span></td>
                        <td>Test rÃ©ussi</td>
                        <td>Aucune action nÃ©cessaire</td>
                    </tr>
                    <tr>
                        <td><span style="color: #e74c3c; font-weight: 600;">âœ•</span></td>
                        <td>Test Ã©chouÃ©</td>
                        <td>VÃ©rifier le message d'erreur et corriger le code</td>
                    </tr>
                    <tr>
                        <td><span style="color: #f39c12; font-weight: 600;">â—‹</span></td>
                        <td>Test ignorÃ© (skipped)</td>
                        <td>Test dÃ©sactivÃ© temporairement avec <code>.skip()</code></td>
                    </tr>
                </tbody>
            </table>

            <h2>âš™ï¸ Configuration Jest</h2>

            <p>La configuration se trouve dans <code>package.json</code> :</p>
            <div class="code-block">
                <code>{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage"
  },
  "devDependencies": {
    "jest": "^30.2.0",
    "supertest": "^7.1.4"
  }
}</code>
            </div>

            <h3>Variables d'environnement</h3>
            <p>Les tests utilisent les mÃªmes variables que l'application (fichier <code>.env</code>) :</p>
            <ul>
                <li><code>DB_USER</code> - Utilisateur PostgreSQL</li>
                <li><code>DB_PASSWORD</code> - Mot de passe</li>
                <li><code>DB_HOST</code> - HÃ´te (localhost par dÃ©faut)</li>
                <li><code>DB_NAME</code> - Nom de la base (gamer_2025)</li>
                <li><code>DB_PORT</code> - Port (5432 par dÃ©faut)</li>
            </ul>

            <h2>âœï¸ Ã‰crire de nouveaux tests</h2>

            <h3>Structure d'un test</h3>
            <div class="code-block">
                <code>// Importations
const request = require('supertest');
const app = require('../server');

// Suite de tests
describe('Nom de la fonctionnalitÃ©', () => {
    
    // PrÃ©paration avant chaque test
    beforeEach(() => {
        // Code de setup
    });

    // Test individuel
    test('devrait faire quelque chose', async () => {
        const response = await request(app)
            .get('/api/endpoint')
            .expect(200);

        expect(response.body).toHaveProperty('success', true);
    });

    // Nettoyage aprÃ¨s chaque test
    afterEach(() => {
        // Code de cleanup
    });
});</code>
            </div>

            <h3>Bonnes pratiques</h3>
            <ul>
                <li>âœ… <strong>Nom descriptif</strong> - "devrait retourner 404 si produit inexistant"</li>
                <li>âœ… <strong>Un concept par test</strong> - Ne pas tester trop de choses Ã  la fois</li>
                <li>âœ… <strong>Tests isolÃ©s</strong> - Chaque test doit Ãªtre indÃ©pendant</li>
                <li>âœ… <strong>Setup/Teardown</strong> - Utiliser beforeEach/afterEach pour prÃ©parer/nettoyer</li>
                <li>âœ… <strong>Assertions claires</strong> - VÃ©rifier exactement ce qui est attendu</li>
                <li>âŒ <strong>Ã‰viter les dÃ©pendances</strong> - Les tests ne doivent pas dÃ©pendre les uns des autres</li>
            </ul>

            <h2>ğŸ› DÃ©pannage</h2>

            <h3>Le serveur ne dÃ©marre pas dans les tests</h3>
            <p><strong>Solution :</strong> VÃ©rifier que le port n'est pas dÃ©jÃ  utilisÃ© et que PostgreSQL est dÃ©marrÃ©.</p>

            <h3>Erreur "Cannot find module"</h3>
            <p><strong>Solution :</strong> Installer les dÃ©pendances :</p>
            <div class="code-block">
                <div style="background: rgba(102, 126, 234, 0.2); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #667eea;">
                    <span style="color: #2ecc71; font-weight: 600; font-size: 0.85em;">bash</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copier</button>
                </div>
                <code>npm install</code>
            </div>

            <h3>Tests qui timeout</h3>
            <p><strong>Solution :</strong> Augmenter le timeout dans le test :</p>
            <div class="code-block">
                <code>test('long test', async () => {
    // ...
}, 10000); // 10 secondes</code>
            </div>

            <h3>Erreur de connexion base de donnÃ©es</h3>
            <p><strong>Solution :</strong> VÃ©rifier que :</p>
            <ul>
                <li>PostgreSQL est dÃ©marrÃ©</li>
                <li>Le fichier <code>.env</code> contient les bonnes informations</li>
                <li>La base de donnÃ©es <code>gamer_2025</code> existe</li>
                <li>Les permissions sont correctes</li>
            </ul>

            <h2>ğŸ“Š MÃ©triques de tests</h2>

            <table>
                <thead>
                    <tr>
                        <th>Suite</th>
                        <th>Tests</th>
                        <th>Statut</th>
                        <th>Temps moyen</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Database</td>
                        <td>3</td>
                        <td><span style="color: #2ecc71; font-weight: 600;">âœ“ Passing</span></td>
                        <td>~60ms</td>
                    </tr>
                    <tr>
                        <td>API</td>
                        <td>6</td>
                        <td><span style="color: #2ecc71; font-weight: 600;">âœ“ Passing</span></td>
                        <td>~900ms</td>
                    </tr>
                    <tr>
                        <td>Generation</td>
                        <td>6</td>
                        <td><span style="color: #2ecc71; font-weight: 600;">âœ“ Passing</span></td>
                        <td>~200ms</td>
                    </tr>
                </tbody>
            </table>

            <h2>ğŸ¯ Prochaines Ã©tapes</h2>

            <p>Pour amÃ©liorer la couverture de tests :</p>
            <ul>
                <li>ğŸ“ Ajouter des tests pour les routes de contenu (actualitÃ©s, technologies, etc.)</li>
                <li>ğŸ” Tester les cas limites et erreurs</li>
                <li>ğŸ§ª Ajouter des tests d'intÃ©gration end-to-end</li>
                <li>âš¡ ImplÃ©menter des tests de performance</li>
                <li>ğŸ”’ Tester la sÃ©curitÃ© et la validation des donnÃ©es</li>
                <li>ğŸ“Š Viser 80%+ de couverture de code</li>
            </ul>

            <div class="nav-bottom" style="display: flex; justify-content: space-between; margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(102, 126, 234, 0.3);">
                <a href="scripts.html" class="nav-button" style="background: #667eea; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; transition: all 0.3s;">â† Scripts</a>
                <a href="workflows.html" class="nav-button" style="background: #667eea; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; transition: all 0.3s;">Workflows â†’</a>
            </div>
        </div>
    </div>

    <div class="footer" style="text-align: center; margin-top: 60px; padding: 30px; border-top: 1px solid rgba(102, 126, 234, 0.3); opacity: 0.7;">
        <p>ğŸ“š Wiki Site Gamer 2025 - Documentation complÃ¨te</p>
        <p>DerniÃ¨re mise Ã  jour : 27 dÃ©cembre 2025</p>
    </div>
    <script>
        function copyCode(button) {
            const block = button.closest('.code-block');
            if (!block) return;
            const codeEl = block.querySelector('code');
            if (!codeEl) return;
            const text = codeEl.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const prev = button.textContent;
                button.textContent = 'CopiÃ© !';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = prev;
                    button.classList.remove('copied');
                }, 1500);
            }).catch(() => {
                const prev = button.textContent;
                button.textContent = 'Erreur';
                setTimeout(() => button.textContent = prev, 1500);
            });
        }
    </script>
</body>
</html>
